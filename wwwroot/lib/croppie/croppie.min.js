(function(n,t){typeof define=="function"&&define.amd?define(t):typeof exports=="object"&&typeof exports.nodeName!="string"?module.exports=t():n.Croppie=t()})(typeof self!="undefined"?self:this,function(){function w(n){if(n in rt)return n;for(var i=n[0].toUpperCase()+n.slice(1),t=it.length;t--;)if(n=it[t]+i,n in rt)return n}function bt(n,t){var i=ut.indexOf(n)>-1?ut:wt,r=i.indexOf(n),u=t/90%i.length;return i[(i.length+r+u%i.length)%i.length]}function v(n,t){n=n||{};for(var i in t)t[i]&&t[i].constructor&&t[i].constructor===Object?(n[i]=n[i]||{},v(n[i],t[i])):n[i]=t[i];return n}function b(n){return v({},n)}function kt(n,t,i){var r;return function(){var u=this,f=arguments,e=function(){r=null;i||n.apply(u,f)},o=i&&!r;clearTimeout(r);r=setTimeout(e,t);o&&n.apply(u,f)}}function k(n){if("createEvent"in document){var t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0);n.dispatchEvent(t)}else n.fireEvent("onchange")}function n(n,t,i){var u,r;typeof t=="string"&&(u=t,t={},t[u]=i);for(r in t)n.style[r]=t[r]}function i(n,t){n.classList?n.classList.add(t):n.className+=" "+t}function dt(n,t){n.classList?n.classList.remove(t):n.className=n.className.replace(t,"")}function ft(n,t){for(var i in t)n.setAttribute(i,t[i])}function s(n){return parseInt(n,10)}function gt(n,t){var i=new Image;return i.style.opacity="0",new Promise(function(r,u){function f(){i.style.opacity="1";setTimeout(function(){r(i)},1)}i.removeAttribute("crossOrigin");n.match(/^https?:\/\/|^\/\//)&&i.setAttribute("crossOrigin","anonymous");i.onload=function(){t?EXIF.getData(i,function(){f()}):f()};i.onerror=function(n){i.style.opacity=1;setTimeout(function(){u(n)},1)};i.src=n})}function et(n,t){var i=n.naturalWidth,r=n.naturalHeight,u=t||d(n),f;return u&&u>=5&&(f=i,i=r,r=f),{width:i,height:r}}function d(n){return n.exifdata&&n.exifdata.Orientation?s(n.exifdata.Orientation):1}function st(n,t,i){var u=t.width,f=t.height,r=n.getContext("2d");n.width=t.width;n.height=t.height;r.save();switch(i){case 2:r.translate(u,0);r.scale(-1,1);break;case 3:r.translate(u,f);r.rotate(Math.PI/1);break;case 4:r.translate(0,f);r.scale(1,-1);break;case 5:n.width=f;n.height=u;r.rotate(Math.PI/2);r.scale(1,-1);break;case 6:n.width=f;n.height=u;r.rotate(Math.PI/2);r.translate(0,-f);break;case 7:n.width=f;n.height=u;r.rotate(Math.PI/-2);r.translate(-u,f);r.scale(1,-1);break;case 8:n.width=f;n.height=u;r.translate(0,u);r.rotate(Math.PI/-2)}r.drawImage(t,0,0,u,f);r.restore()}function ni(){var t=this,s=t.options.viewport.type?"cr-vp-"+t.options.viewport.type:null,r,h,u,f,e,o;t.options.useCanvas=t.options.enableOrientation||ht.call(t);t.data={};t.elements={};r=t.elements.boundary=document.createElement("div");u=t.elements.viewport=document.createElement("div");h=t.elements.img=document.createElement("img");f=t.elements.overlay=document.createElement("div");t.options.useCanvas?(t.elements.canvas=document.createElement("canvas"),t.elements.preview=t.elements.canvas):t.elements.preview=h;i(r,"cr-boundary");r.setAttribute("aria-dropeffect","none");e=t.options.boundary.width;o=t.options.boundary.height;n(r,{width:e+(isNaN(e)?"":"px"),height:o+(isNaN(o)?"":"px")});i(u,"cr-viewport");s&&i(u,s);n(u,{width:t.options.viewport.width+"px",height:t.options.viewport.height+"px"});u.setAttribute("tabindex",0);i(t.elements.preview,"cr-image");ft(t.elements.preview,{alt:"preview","aria-grabbed":"false"});i(f,"cr-overlay");t.element.appendChild(r);r.appendChild(t.elements.preview);r.appendChild(u);r.appendChild(f);i(t.element,"croppie-container");t.options.customClass&&i(t.element,t.options.customClass);fi.call(this);t.options.enableZoom&&ii.call(t);t.options.enableResize&&ti.call(t)}function ht(){return this.options.enableExif&&window.EXIF}function ti(){function h(n){var i,r;(n.button===undefined||n.button===0)&&((n.preventDefault(),v)||(i=t.elements.overlay.getBoundingClientRect(),v=!0,e=n.pageX,s=n.pageY,w=n.currentTarget.className.indexOf("vertical")!==-1?"v":"h",k=i.width,d=i.height,n.touches&&(r=n.touches[0],e=r.pageX,s=r.pageY),window.addEventListener("mousemove",c),window.addEventListener("touchmove",c),window.addEventListener("mouseup",l),window.addEventListener("touchend",l),document.body.style[o]="none"))}function c(i){var u=i.pageX,f=i.pageY,o;i.preventDefault();i.touches&&(o=i.touches[0],u=o.pageX,f=o.pageY);var h=u-e,c=f-s,l=t.options.viewport.height+c,v=t.options.viewport.width+h;w==="v"&&l>=b&&l<=d?(n(r,{height:l+"px"}),t.options.boundary.height+=c,n(t.elements.boundary,{height:t.options.boundary.height+"px"}),t.options.viewport.height+=c,n(t.elements.viewport,{height:t.options.viewport.height+"px"})):w==="h"&&v>=b&&v<=k&&(n(r,{width:v+"px"}),t.options.boundary.width+=h,n(t.elements.boundary,{width:t.options.boundary.width+"px"}),t.options.viewport.width+=h,n(t.elements.viewport,{width:t.options.viewport.width+"px"}));p.call(t);nt.call(t);y.call(t);a.call(t);s=f;e=u}function l(){v=!1;window.removeEventListener("mousemove",c);window.removeEventListener("touchmove",c);window.removeEventListener("mouseup",l);window.removeEventListener("touchend",l);document.body.style[o]=""}var t=this,r=document.createElement("div"),v=!1,w,e,s,b=50,k,d,u,f;i(r,"cr-resizer");n(r,{width:this.options.viewport.width+"px",height:this.options.viewport.height+"px"});this.options.resizeControls.height&&(u=document.createElement("div"),i(u,"cr-resizer-vertical"),r.appendChild(u));this.options.resizeControls.width&&(f=document.createElement("div"),i(f,"cr-resizer-horisontal"),r.appendChild(f));u&&(u.addEventListener("mousedown",h),u.addEventListener("touchstart",h));f&&(f.addEventListener("mousedown",h),f.addEventListener("touchstart",h));this.elements.boundary.appendChild(r)}function l(n){if(this.options.enableZoom){var t=this.elements.zoomer,i=h(n,4);t.value=Math.max(parseFloat(t.min),Math.min(parseFloat(t.max),i)).toString()}}function ii(){function f(){ri.call(n,{value:parseFloat(r.value),origin:new c(n.elements.preview),viewportRect:n.elements.viewport.getBoundingClientRect(),transform:t.parse(n.elements.preview)})}function e(t){var i,r;if(n.options.mouseWheelZoom==="ctrl"&&t.ctrlKey!==!0)return 0;i=t.wheelDelta?t.wheelDelta/1200:t.deltaY?t.deltaY/1060:t.detail?t.detail/-60:0;r=n._currentZoom+i*n._currentZoom;t.preventDefault();l.call(n,r);f.call(n)}var n=this,u=n.elements.zoomerWrap=document.createElement("div"),r=n.elements.zoomer=document.createElement("input");i(u,"cr-slider-wrap");i(r,"cr-slider");r.type="range";r.step="0.0001";r.value="1";r.style.display=n.options.showZoomer?"":"none";r.setAttribute("aria-label","zoom");n.element.appendChild(u);u.appendChild(r);n._currentZoom=1;n.elements.zoomer.addEventListener("input",f);n.elements.zoomer.addEventListener("change",f);n.options.mouseWheelZoom&&(n.elements.boundary.addEventListener("mousewheel",e),n.elements.boundary.addEventListener("DOMMouseScroll",e))}function ri(i){function l(){var t={};t[r]=f.toString();t[e]=s.toString();n(u.elements.preview,t)}var u=this,f=i?i.transform:t.parse(u.elements.preview),y=i?i.viewportRect:u.elements.viewport.getBoundingClientRect(),s=i?i.origin:new c(u.elements.preview);if(u._currentZoom=i?i.value:u._currentZoom,f.scale=u._currentZoom,u.elements.zoomer.setAttribute("aria-valuenow",u._currentZoom),l(),u.options.enforceBoundary){var v=ui.call(u,y),o=v.translate,h=v.origin;f.x>=o.maxX&&(s.x=h.minX,f.x=o.maxX);f.x<=o.minX&&(s.x=h.maxX,f.x=o.minX);f.y>=o.maxY&&(s.y=h.minY,f.y=o.maxY);f.y<=o.minY&&(s.y=h.maxY,f.y=o.minY)}l();ct.call(u);a.call(u)}function ui(n){var i=this,t=i._currentZoom,r=n.width,u=n.height,y=i.elements.boundary.clientWidth/2,p=i.elements.boundary.clientHeight/2,f=i.elements.preview.getBoundingClientRect(),e=f.width,o=f.height,s=r/2,h=u/2,c=(s/t-y)*-1,w=c-(e*(1/t)-r*(1/t)),l=(h/t-p)*-1,b=l-(o*(1/t)-u*(1/t)),a=1/t*s,k=e*(1/t)-a,v=1/t*h,d=o*(1/t)-v;return{translate:{maxX:c,minX:w,maxY:l,minY:b},origin:{maxX:k,minX:a,maxY:d,minY:v}}}function y(i){var o=this,s=o._currentZoom,y=o.elements.preview.getBoundingClientRect(),h=o.elements.viewport.getBoundingClientRect(),f=t.parse(o.elements.preview.style[r]),l=new c(o.elements.preview),p=h.top-y.top+h.height/2,w=h.left-y.left+h.width/2,u={},a={},v;if(i){var b=l.x,k=l.y,d=f.x,g=f.y;u.y=b;u.x=k;f.y=d;f.x=g}else u.y=p/s,u.x=w/s,a.y=(u.y-l.y)*(1-s),a.x=(u.x-l.x)*(1-s),f.x-=a.x,f.y-=a.y;v={};v[e]=u.x+"px "+u.y+"px";v[r]=f.toString();n(o.elements.preview,v)}function fi(){function b(n,t){var r=i.elements.preview.getBoundingClientRect(),e=u.y+t,o=u.x+n;i.options.enforceBoundary?(f.top>r.top+t&&f.bottom<r.bottom+t&&(u.y=e),f.left>r.left+n&&f.right<r.right+n&&(u.x=o)):(u.y=e,u.x=o)}function d(n){i.elements.preview.setAttribute("aria-grabbed",n);i.elements.boundary.setAttribute("aria-dropeffect",n?"move":"none")}function nt(n){function a(n){switch(n){case c:return[1,0];case r:return[0,1];case l:return[-1,0];case e:return[0,-1]}}var c=37,r=38,l=39,e=40,s,h;n.shiftKey&&(n.keyCode===r||n.keyCode===e)?(s=n.keyCode===r?parseFloat(i.elements.zoomer.value)+parseFloat(i.elements.zoomer.step):parseFloat(i.elements.zoomer.value)-parseFloat(i.elements.zoomer.step),i.setZoom(s)):i.options.enableKeyMovement&&n.keyCode>=37&&n.keyCode<=40&&(n.preventDefault(),h=a(n.keyCode),u=t.parse(i.elements.preview),document.body.style[o]="none",f=i.elements.viewport.getBoundingClientRect(),tt(h))}function tt(t){var e=t[0],h=t[1],f={};b(e,h);f[r]=u.toString();n(i.elements.preview,f);p.call(i);document.body.style[o]="";y.call(i);a.call(i);s=0}function g(n){if((n.button===undefined||n.button===0)&&(n.preventDefault(),!e)){if(e=!0,h=n.pageX,c=n.pageY,n.touches){var r=n.touches[0];h=r.pageX;c=r.pageY}d(e);u=t.parse(i.elements.preview);window.addEventListener("mousemove",v);window.addEventListener("touchmove",v);window.addEventListener("mouseup",w);window.addEventListener("touchend",w);document.body.style[o]="none";f=i.elements.viewport.getBoundingClientRect()}}function v(t){var f,e,v,d;t.preventDefault();f=t.pageX;e=t.pageY;t.touches&&(v=t.touches[0],f=v.pageX,e=v.pageY);var g=f-h,nt=e-c,y={};if(t.type==="touchmove"&&t.touches.length>1){var o=t.touches[0],a=t.touches[1],w=Math.sqrt((o.pageX-a.pageX)*(o.pageX-a.pageX)+(o.pageY-a.pageY)*(o.pageY-a.pageY));s||(s=w/i._currentZoom);d=w/s;l.call(i,d);k(i.elements.zoomer);return}b(g,nt);y[r]=u.toString();n(i.elements.preview,y);p.call(i);c=e;h=f}function w(){e=!1;d(e);window.removeEventListener("mousemove",v);window.removeEventListener("touchmove",v);window.removeEventListener("mouseup",w);window.removeEventListener("touchend",w);document.body.style[o]="";y.call(i);a.call(i);s=0}var i=this,e=!1,h,c,s,f,u;i.elements.overlay.addEventListener("mousedown",g);i.elements.viewport.addEventListener("keydown",nt);i.elements.overlay.addEventListener("touchstart",g)}function p(){if(this.elements){var i=this,r=i.elements.boundary.getBoundingClientRect(),t=i.elements.preview.getBoundingClientRect();n(i.elements.overlay,{width:t.width+"px",height:t.height+"px",top:t.top-r.top+"px",left:t.left-r.left+"px"})}}function a(){var n=this,t=n.get(),i;lt.call(n)&&(n.options.update.call(n,t),n.$&&typeof Prototype=="undefined"?n.$(n.element).trigger("update.croppie",t):(window.CustomEvent?i=new CustomEvent("update",{detail:t}):(i=document.createEvent("CustomEvent"),i.initCustomEvent("update",!0,!0,t)),n.element.dispatchEvent(i)))}function lt(){return this.elements.preview.offsetHeight>0&&this.elements.preview.offsetWidth>0}function g(){var i=this,s=1,u={},h=i.elements.preview,f,o=new t(0,0,s),l=new c,a=lt.call(i);a&&!i.data.bound&&(i.data.bound=!0,u[r]=o.toString(),u[e]=l.toString(),u.opacity=1,n(h,u),f=i.elements.preview.getBoundingClientRect(),i._originalImageWidth=f.width,i._originalImageHeight=f.height,i.data.orientation=d(i.elements.img),i.options.enableZoom?nt.call(i,!0):i._currentZoom=s,o.scale=i._currentZoom,u[r]=o.toString(),n(h,u),i.data.points.length?ei.call(i,i.data.points):oi.call(i),y.call(i),p.call(i))}function nt(n){var t=this,r=0,f=t.options.maxZoom||1.5,o,s,i=t.elements.zoomer,e=parseFloat(i.value),c=t.elements.boundary.getBoundingClientRect(),u=et(t.elements.img,t.data.orientation),a=t.elements.viewport.getBoundingClientRect(),v,y;t.options.enforceBoundary&&(v=a.width/u.width,y=a.height/u.height,r=Math.max(v,y));r>=f&&(f=r+1);i.min=h(r,4);i.max=h(f,4);!n&&(e<i.min||e>i.max)?l.call(t,e<i.min?i.min:i.max):n&&(s=Math.max(c.width/u.width,c.height/u.height),o=t.data.boundZoom!==null?t.data.boundZoom:s,l.call(t,o));k(i)}function ei(i){if(i.length!==4)throw"Croppie - Invalid number of points supplied: "+i;var u=this,a=i[2]-i[0],f=u.elements.viewport.getBoundingClientRect(),h=u.elements.boundary.getBoundingClientRect(),c={left:f.left-h.left,top:f.top-h.top},o=f.width/a,v=i[1],y=i[0],p=-1*i[1]+c.top,w=-1*i[0]+c.left,s={};s[e]=y+"px "+v+"px";s[r]=new t(w,p,o).toString();n(u.elements.preview,s);l.call(u,o);u._currentZoom=o}function oi(){var i=this,f=i.elements.preview.getBoundingClientRect(),u=i.elements.viewport.getBoundingClientRect(),e=i.elements.boundary.getBoundingClientRect(),o=u.left-e.left,s=u.top-e.top,h=o-(f.width-u.width)/2,c=s-(f.height-u.height)/2,l=new t(h,c,i._currentZoom);n(i.elements.preview,r,l.toString())}function si(n){var r=this,t=r.elements.canvas,i=r.elements.img,f=t.getContext("2d"),u;f.clearRect(0,0,t.width,t.height);t.width=i.width;t.height=i.height;u=r.options.enableOrientation&&n||d(i);st(t,i,u)}function tt(n){var e=this,r=n.points,c=s(r[0]),l=s(r[1]),a=s(r[2]),v=s(r[3]),u=a-c,f=v-l,y=n.circle,i=document.createElement("canvas"),t=i.getContext("2d"),o=n.outputWidth||u,h=n.outputHeight||f;return i.width=o,i.height=h,n.backgroundColor&&(t.fillStyle=n.backgroundColor,t.fillRect(0,0,o,h)),e.options.enforceBoundary!==!1&&(u=Math.min(u,e._originalImageWidth),f=Math.min(f,e._originalImageHeight)),t.drawImage(this.elements.preview,c,l,u,f,0,0,o,h),y&&(t.fillStyle="#fff",t.globalCompositeOperation="destination-in",t.beginPath(),t.arc(i.width/2,i.height/2,i.width/2,0,Math.PI*2,!0),t.closePath(),t.fill()),i}function hi(t){var r=t.points,u=document.createElement("div"),f=document.createElement("img"),e=r[2]-r[0],o=r[3]-r[1];return i(u,"croppie-result"),u.appendChild(f),n(f,{left:-1*r[0]+"px",top:-1*r[1]+"px"}),f.src=t.url,n(u,{width:e+"px",height:o+"px"}),u}function ci(n){return tt.call(this,n).toDataURL(n.format,n.quality)}function li(n){var t=this;return new Promise(function(i){tt.call(t,n).toBlob(function(n){i(n)},n.format,n.quality)})}function ai(n){this.elements.img.parentNode&&(Array.prototype.forEach.call(this.elements.img.classList,function(t){n.classList.add(t)}),this.elements.img.parentNode.replaceChild(n,this.elements.img),this.elements.preview=n);this.elements.img=n}function at(n,t){var i=this,u,r=[],f=null,e=ht.call(i);if(typeof n=="string")u=n,n={};else if(Array.isArray(n))r=n.slice();else{if(typeof n=="undefined"&&i.data.url)return g.call(i),a.call(i),null;u=n.url;r=n.points||[];f=typeof n.zoom=="undefined"?null:n.zoom}return i.data.bound=!1,i.data.url=u||i.data.url,i.data.boundZoom=f,gt(u,e).then(function(u){if(ai.call(i,u),r.length)i.options.relative&&(r=[r[0]*u.naturalWidth/100,r[1]*u.naturalHeight/100,r[2]*u.naturalWidth/100,r[3]*u.naturalHeight/100]);else{var f=et(u),h=i.elements.viewport.getBoundingClientRect(),s=h.width/h.height,v=f.width/f.height,o,e;v>s?(e=f.height,o=e*s):(o=f.width,e=f.height/s);var c=(f.width-o)/2,l=(f.height-e)/2,y=c+o,p=l+e;i.data.points=[c,l,y,p]}i.data.points=r.map(function(n){return parseFloat(n)});i.options.useCanvas&&si.call(i,n.orientation);g.call(i);a.call(i);t&&t()})}function h(n,t){return parseFloat(n).toFixed(t||0)}function vt(){var n=this,s=n.elements.preview.getBoundingClientRect(),r=n.elements.viewport.getBoundingClientRect(),u=r.left-s.left,f=r.top-s.top,c=(r.width-n.elements.viewport.offsetWidth)/2,l=(r.height-n.elements.viewport.offsetHeight)/2,e=u+n.elements.viewport.offsetWidth+c,o=f+n.elements.viewport.offsetHeight+l,t=n._currentZoom,i;return(t===Infinity||isNaN(t))&&(t=1),i=n.options.enforceBoundary?0:Number.NEGATIVE_INFINITY,u=Math.max(i,u/t),f=Math.max(i,f/t),e=Math.max(i,e/t),o=Math.max(i,o/t),{points:[h(u),h(f),h(e),h(o)],zoom:t,orientation:n.data.orientation}}function vi(n){var r=this,t=vt.call(r),u=v(b(yt),b(n)),s=typeof n=="string"?n:u.type||"base64",i=u.size||"viewport",e=u.format,h=u.quality,c=u.backgroundColor,l=typeof u.circle=="boolean"?u.circle:r.options.viewport.type==="circle",f=r.elements.viewport.getBoundingClientRect(),o=f.width/f.height;return i==="viewport"?(t.outputWidth=f.width,t.outputHeight=f.height):typeof i=="object"&&(i.width&&i.height?(t.outputWidth=i.width,t.outputHeight=i.height):i.width?(t.outputWidth=i.width,t.outputHeight=i.width/o):i.height&&(t.outputWidth=i.height*o,t.outputHeight=i.height)),pt.indexOf(e)>-1&&(t.format="image/"+e,t.quality=h),t.circle=l,t.url=r.data.url,t.backgroundColor=c,new Promise(function(n){switch(s.toLowerCase()){case"rawcanvas":n(tt.call(r,t));break;case"canvas":case"base64":n(ci.call(r,t));break;case"blob":li.call(r,t).then(n);break;default:n(hi.call(r,t))}})}function yi(){g.call(this)}function pi(n){if(!this.options.useCanvas||!this.options.enableOrientation)throw"Croppie: Cannot rotate without enableOrientation && EXIF.js included";var t=this,i=t.elements.canvas;t.data.orientation=bt(t.data.orientation,n);st(i,t.elements.img,t.data.orientation);y.call(t,!0);nt.call(t)}function wi(){var n=this;n.element.removeChild(n.elements.boundary);dt(n.element,"croppie-container");n.options.enableZoom&&n.element.removeChild(n.elements.zoomerWrap);delete n.elements}function u(n,t){var r,f,e;if(n.className.indexOf("croppie-container")>-1)throw new Error("Croppie: Can't initialize croppie more than once");this.element=n;this.options=v(b(u.defaults),t);this.element.tagName.toLowerCase()==="img"&&(r=this.element,i(r,"cr-original-image"),ft(r,{"aria-hidden":"true",alt:""}),f=document.createElement("div"),this.element.parentNode.appendChild(f),f.appendChild(r),this.element=f,this.options.url=this.options.url||r.src);ni.call(this);this.options.url&&(e={url:this.options.url,points:this.options.points},delete this.options.url,delete this.options.points,at.call(this,e))}var ot,t,c,ct,yt,pt,f;if(typeof Promise!="function"){
/*! promise-polyfill 3.1.0 */
!function(n){function i(n,t){return function(){n.apply(t,arguments)}}function t(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null;this._value=null;this._deferreds=[];o(n,i(f,this),i(r,this))}function u(n){var t=this;return null===this._state?void this._deferreds.push(n):void s(function(){var i=t._state?n.onFulfilled:n.onRejected,r;if(null===i)return void(t._state?n.resolve:n.reject)(t._value);try{r=i(t._value)}catch(u){return void n.reject(u)}n.resolve(r)})}function f(n){try{if(n===this)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if("function"==typeof t)return void o(i(t,n),i(f,this),i(r,this))}this._state=!0;this._value=n;e.call(this)}catch(u){r.call(this,u)}}function r(n){this._state=!1;this._value=n;e.call(this)}function e(){for(var n=0,t=this._deferreds.length;t>n;n++)u.call(this,this._deferreds[n]);this._deferreds=null}function h(n,t,i,r){this.onFulfilled="function"==typeof n?n:null;this.onRejected="function"==typeof t?t:null;this.resolve=i;this.reject=r}function o(n,t,i){var r=!1;try{n(function(n){r||(r=!0,t(n))},function(n){r||(r=!0,i(n))})}catch(u){if(r)return;r=!0;i(u)}}var c=setTimeout,s="function"==typeof setImmediate&&setImmediate||function(n){c(n,1)},l=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)};t.prototype["catch"]=function(n){return this.then(null,n)};t.prototype.then=function(n,i){var r=this;return new t(function(t,f){u.call(r,new h(n,i,t,f))})};t.all=function(){var n=Array.prototype.slice.call(1===arguments.length&&l(arguments[0])?arguments[0]:arguments);return new t(function(t,i){function u(r,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var o=e.then;if("function"==typeof o)return void o.call(e,function(n){u(r,n)},i)}n[r]=e;0==--f&&t(n)}catch(s){i(s)}}if(0===n.length)return t([]);for(var f=n.length,r=0;r<n.length;r++)u(r,n[r])})};t.resolve=function(n){return n&&"object"==typeof n&&n.constructor===t?n:new t(function(t){t(n)})};t.reject=function(n){return new t(function(t,i){i(n)})};t.race=function(n){return new t(function(t,i){for(var r=0,u=n.length;u>r;r++)n[r].then(t,i)})};t._setImmediateFn=function(n){s=n};"undefined"!=typeof module&&module.exports?module.exports=t:n.Promise||(n.Promise=t)}(this)}typeof CustomEvent!="function"&&function(){function n(n,t){t=t||{bubbles:!1,cancelable:!1,detail:undefined};var i=document.createEvent("CustomEvent");return i.initCustomEvent(n,t.bubbles,t.cancelable,t.detail),i}n.prototype=window.Event.prototype;window.CustomEvent=n}();HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(n,t,i){for(var u=atob(this.toDataURL(t,i).split(",")[1]),f=u.length,e=new Uint8Array(f),r=0;r<f;r++)e[r]=u.charCodeAt(r);n(new Blob([e],{type:t||"image/png"}))}});var it=["Webkit","Moz","ms"],rt=document.createElement("div").style,ut=[1,8,3,6],wt=[2,7,4,5],e,r,o;return r=w("transform"),e=w("transformOrigin"),o=w("userSelect"),ot={translate3d:{suffix:", 0px"},translate:{suffix:""}},t=function(n,t,i){this.x=parseFloat(n);this.y=parseFloat(t);this.scale=parseFloat(i)},t.parse=function(n){return n.style?t.parse(n.style[r]):n.indexOf("matrix")>-1||n.indexOf("none")>-1?t.fromMatrix(n):t.fromString(n)},t.fromMatrix=function(n){var i=n.substring(7).split(",");return i.length&&n!=="none"||(i=[1,0,0,1,0,0]),new t(s(i[4]),s(i[5]),parseFloat(i[0]))},t.fromString=function(n){var r=n.split(") "),i=r[0].substring(u.globals.translate.length+1).split(","),f=r.length>1?r[1].substring(6):1,e=i.length>1?i[0]:0,o=i.length>1?i[1]:0;return new t(e,o,f)},t.prototype.toString=function(){var n=ot[u.globals.translate].suffix||"";return u.globals.translate+"("+this.x+"px, "+this.y+"px"+n+") scale("+this.scale+")"},c=function(n){if(!n||!n.style[e]){this.x=0;this.y=0;return}var t=n.style[e].split(" ");this.x=parseFloat(t[0]);this.y=parseFloat(t[1])},c.prototype.toString=function(){return this.x+"px "+this.y+"px"},ct=kt(p,500),yt={type:"canvas",format:"png",quality:1},pt=["jpeg","webp","png"],window.jQuery&&(f=window.jQuery,f.fn.croppie=function(n){var r=typeof n,i,t;return r==="string"?(i=Array.prototype.slice.call(arguments,1),t=f(this).data("croppie"),n==="get")?t.get():n==="result"?t.result.apply(t,i):n==="bind"?t.bind.apply(t,i):this.each(function(){var t=f(this).data("croppie"),r;if(t)if(r=t[n],f.isFunction(r))r.apply(t,i),n==="destroy"&&f(this).removeData("croppie");else throw"Croppie "+n+" method not found";}):this.each(function(){var t=new u(this,n);t.$=f;f(this).data("croppie",t)})}),u.defaults={viewport:{width:100,height:100,type:"square"},boundary:{},orientationControls:{enabled:!0,leftClass:"",rightClass:""},resizeControls:{width:!0,height:!0},customClass:"",showZoomer:!0,enableZoom:!0,enableResize:!1,mouseWheelZoom:!0,enableExif:!1,enforceBoundary:!0,enableOrientation:!1,enableKeyMovement:!0,update:function(){}},u.globals={translate:"translate3d"},v(u.prototype,{bind:function(n,t){return at.call(this,n,t)},get:function(){var t=vt.call(this),n=t.points;return this.options.relative&&(n[0]/=this.elements.img.naturalWidth/100,n[1]/=this.elements.img.naturalHeight/100,n[2]/=this.elements.img.naturalWidth/100,n[3]/=this.elements.img.naturalHeight/100),t},result:function(n){return vi.call(this,n)},refresh:function(){return yi.call(this)},setZoom:function(n){l.call(this,n);k(this.elements.zoomer)},rotate:function(n){pi.call(this,n)},destroy:function(){return wi.call(this)}}),u});