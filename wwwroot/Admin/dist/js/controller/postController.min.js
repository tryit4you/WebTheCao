var config={pageSize:12,pageIndex:1,viewport:{width:189,height:245}},postController={init:function(){postController.loadData();postController.registerEvent()},registerEvent:function(){$(".datepicker").datepicker({format:"mm/dd/yyyy"});jQuery.validator.setDefaults({debug:!0,success:"valid"});$("#frmAddNew").validate({rules:{Name:{required:!0},Image:"required"},messages:{Name:{required:"Tên là bắt buộc"},Image:"Yêu cầu có ảnh đại diện"}});$("#frmUpdate").validate({rules:{EditName:{required:!0},EditImage:"required"},messages:{EditName:{required:"Tên là bắt buộc"},EditImage:"Yêu cầu có ảnh đại diện"}});$("#btnAdd").off("click").on("click",function(){if($("#frmAddNew").valid()){var n=$("#txtName").val();postController.checkExist(n)}});$("#SaveEdit").off("click").on("click",function(){$("#frmUpdate").valid()&&postController.Put()});$(".btn-showTable").off("click").on("click",function(){$(".show-Table").removeClass("hidden");$(".show-Table").show(3e3);$(".show-Colapse").addClass("hidden");$(".show-Colapse").hide(2e3)});$(".btn-showCollapse").off("click").on("click",function(){$(".show-Colapse").removeClass("hidden");$(".show-Colapse").show(2e3);$(".show-Table").addClass("hidden");$(".show-Table").hide(3e3)});$(".btn-active").off("click").on("click",function(n){n.preventDefault();var i=$(this).data("id"),t=$(this);$.ajax({url:"/admin/post/ChangeStatus",data:{id:i},type:"post",dataType:"json",success:function(n){n.message===null?toastr.error(n.message):n.status?(t.removeClass("bg-red"),t.addClass("bg-green"),toastr.remove(),toastr.info("Đã kích hoạt"),t.html("<i class='fa fa-check'>Active<\/i>")):(t.removeClass("bg-green"),t.addClass("bg-red"),toastr.remove(),toastr.info("Đã hủy kích hoạt"),t.html("<i class='fa fa-ban'>NotActive<\/i>"))}})});$(".btn-edit").off("click").on("click",function(){var n=$(this).data("id");$("ul.nav.nav-tabs a:eq(2)").tab("show");$("#editTab").toggleClass("disabledTab");postController.loadDetail(n)});$(".btn-delete").off("click").on("click",function(){var n=$(this).data("id");bootbox.confirm("Bạn có chắc chắn muốn xóa danh mục này không?",function(t){t&&postController.delete(n)})});$("#btn-Deletemulti").off("click").on("click",function(){bootbox.confirm("Bạn có chắc muốn xóa các bản ghi được chọn không?",function(n){n&&postController.deleteMul()})});$(".btn-clear").off("click").on("click",function(){$("#txtSearch").val("");postController.loadData()});$("#txtSearch").keypress(function(n){n.keyCode===13&&postController.loadData(!0)});$("#selectAll").change(function(){$(".selectedItem").prop("checked",$(this).prop("checked"));$("#btn-Deletemulti").removeAttr("disabled")});$(".selectedItem").on("click",function(){$(this).attr("checked",this.checked?"":"checked")});$(".selectedItem").on("change",function(){var n=$(".selectedItem").attr("checked").length;n>1?$("#btn-Deletemulti").removeAttr("disabled"):$("#btn-Deletemulti").add("disabled")})},"delete":function(n){$.ajax({url:"/admin/post/Delete",data:{id:n},type:"post",dataType:"json",success:function(){toastr.success("Xóa thành công");postController.loadData(!0)}})},deleteMul:function(){var n=[];$("td input:checked").each(function(){n.push($(this).data("id"))});n.length===0?toastr.warning("Không có phần tử nào được chọn!"):$.ajax({url:"/admin/post/DeleteMul",data:{ids:n},type:"post",dataType:"json",success:function(n){n.status?(toastr.success(n.message),postController.loadData(!0)):(toastr.error(n.message),postController.loadData(!0))}})},checkExist:function(n){$.ajax({url:"/admin/post/CheckExist",data:{name:n},type:"post",dataType:"json",success:function(t){t.result===!0?postController.Post():($(".validate").html("Tên "+n+" đã tồn tại!"),toastr.error("Tên "+n+" đã tồn tại!"))}})},loadDetail:function(n){$.ajax({url:"/admin/post/GetDetail",data:{id:n},type:"POST",dataType:"json",success:function(n){if(n.status===!0){var t=n.data;$("#EditId").val(t.id);$("#EditName").val(t.name);tinymce.get("EditContent").setContent(t.content);$("#EditThumbnail").attr("src",t.avatar);$("#EditVia").val(t.via);$("#EditLinkVia").val(t.linkVia);$("#EditStatus").prop("checked",t.status)}else toastr.error(n.message),postController.loadData(!0)}})},Post:function(){var n=$("#txtName").val(),t=commonController.getSeoTitle(n),i=$("#ImgThumbnail").attr("src"),r=tinymce.get("txtContent").getContent(),u=$("#txtVia").val(),f=$("#txtLinkVia").val(),e=$("#txtStatus").prop("checked"),o={Name:n,MetaName:t,Avatar:i,Content:r,Via:u,LinkVia:f,Status:e};$.ajax({url:"/admin/post/Post",data:{post:JSON.stringify(o)},type:"post",dataType:"json",success:function(n){n.status?(postController.loadData(!0),toastr.success(n.message)):toastr.error(n.message)}})},Put:function(){var t=$("#EditId").val(),n=$("#EditName").val(),i=$("#EditImage").attr("src"),r=tinymce.get("EditContent").getContent(),u=$("#EditVia").val(),f=$("#EditLinkVia").val(),e=$("#EditStatus").prop("checked"),o={Id:t,Name:n,MetaName:commonController.getSeoTitle(n),Avatar:i,Content:r,Via:u,LinkVia:f,Status:e};$.ajax({url:"/admin/post/Put",data:{post:JSON.stringify(o)},type:"post",dataType:"json",success:function(n){n.status?(postController.loadData(!0),toastr.success(n.message)):toastr.error(n.message)}})},loadData:function(n){var t=$("#txtSearch").val();$.ajax({url:"/admin/post/GetAll",type:"post",data:{filter:t,page:config.pageIndex,pageSize:config.pageSize},dataType:"json",success:function(t){var r;if(t.status){var u=t.data,i="",f=$("#data-template").html();$.each(u,function(n,t){i+=Mustache.render(f,{ID:t.id,Name:t.name,Image:t.avatar,CreatedDate:$.datepicker.formatDate("dd-mm-yy",new Date(t.createdDate)),Via:t.via,LinkVia:t.linkVia,Status:t.status?"<a href='#' class='btn-active badge bg-green' data-id='"+t.id+"'><i class='fa fa-check'>Active<\/i><\/a>":"<a href='#' class='btn-active badge bg-red' data-id='"+t.id+"'><i class='fa fa-ban'>NotActive<\/i><\/a>"})});$("#tbData").html(i);r=Math.ceil(t.total/config.pageSize);postController.paging(t.total,function(){postController.loadData();$("#currentpage").html(config.pageIndex);$("#totalpage").html(r)},n);postController.registerEvent()}}})},paging:function(n,t,i){var r=Math.ceil(n/config.pageSize);($("#pagination a").length===0||i===!0)&&($("#pagination").empty(),$("#pagination").removeData("twbs-pagination"),$("#pagination").unbind("page"));$("#pagination").twbsPagination({totalPages:r,first:"Đầu",prev:"Trước",next:"Tiếp ",last:"Cuối",visiblePages:10,onPageClick:function(n,i){config.pageIndex=i;setTimeout(t,200)}})}};postController.init();