var config={pageSize:20,pageIndex:1},rolesScripts={Init:function(){rolesScripts.registerEvent();rolesScripts.loadData(!0)},registerEvent:function(){$("#frmAddNew").validate({rules:{DisplayName:{required:!0},UserName:{required:!0},PhoneNumber:{required:!0,minlength:10,number:!0},Email:{required:!0},Password:{required:!0,minlength:8},ConfirmPassword:{required:!0,equalTo:'[name="Password"]'}},messages:{DisplayName:{required:"Yêu cầu nhập họ tên"},UserName:{required:"Yêu cầu tên tài khoản"},PhoneNumber:{required:"Yêu cầu số điện thoại",minlength:"Số điện thoại ít nhất 10 ký tự",number:"Số điện thoại không đúng"},Email:{required:"Yêu cầu nhập email"},Password:{required:"Yêu cầu nhập mật khẩu",minlength:"Mật khẩu phải chứa ít nhất 8 ký tự"},ConfirmPassword:{required:"Yêu cầu nhập mật khẩu xác thực",equalTo:"Mật khẩu xác thực không trùng khớp"}}});$("#frmUpdate").validate({rules:{editDisplayName:{required:"Yêu cầu họ tên"},editUserName:{required:"Yêu cầu tên tài khoản"},editPhoneNumber:{required:"Yêu cầu số điện thoại",minlength:"Số điện thoại ít nhất 10 ký tự",number:"Số điện thoại không đúng"},editEmail:{required:"Yêu cầu nhập email"}},messages:{editDisplayName:{required:"Yêu cầu họ tên"},editUserName:{required:"Yêu cầu tên tài khoản"},editPhoneNumber:{required:"Yêu cầu số điện thoại",minlength:"Số điện thoại ít nhất 10 ký tự",number:"Số điện thoại không đúng"},editEmail:{required:"Yêu cầu nhập email"}}});$("#btnAdd").off("click").on("click",function(){$("#frmAddNew").valid()&&rolesScripts.Post()});$(".btnEdit").off("click").on("click",function(){var n=$(this).data("id");$("ul.nav.nav-tabs a:eq(2)").tab("show");rolesScripts.loadDetail(n)});$("#SaveEdit").off("click").on("click",function(){$("#frmUpdate").valid()&&rolesScripts.Put()});$("#btn-Feedback").on("click",function(){$("#frmFeedback").valid()&&rolesScripts.sendFeedback()});$(".btnSave").off("click").on("click",function(){$("#frmUpdate").valid()&&rolesScripts.SaveChange()})},checkExist:function(n){$.ajax({url:"/Books/CheckExist",data:{name:n},type:"post",dataType:"json",success:function(t){t.result===!0?rolesScripts.Post():$(".validate").html("Tên "+n+" đã tồn tại!")}})},loadDetail:function(n){$.ajax({url:"/admin/account/GetDetail",data:{id:n},type:"POST",dataType:"json",success:function(n){if(n.status===!0){var t=n.data.giaodich;$("#EditId").val(t.id);$("#editDisplayName").val(t.displayName);$("#editUserName").val(t.userName);$("#editPhoneNumber").val(t.phoneNumber);$("#editEmail").val(t.email);$("#editPassword").val(t.password);$("#editConfirmPassword").val(t.password)}else toastr.error(n.message),rolesScripts.loadData(!0)}})},Post:function(){var n=$("#txtName").val(),t=$("#txtUserName").val(),i=$("#txtPhone").val(),r=$("#txtEmail").val(),u=$("#txtPassword").val(),f={DisplayName:n,UserName:t,sdt:i,Email:r};$.ajax({url:"/admin/account/create",data:{models:JSON.stringify(f),password:u},type:"post",dataType:"json",success:function(n){n.status?(rolesScripts.loadData(!0),toastr.success(n.message)):$.each(n.errors,function(n,t){toastr.error(t)})}})},Put:function(){var e=$("#EditId").val(),n=$("#editDisplayName").val(),t=$("#editUserName").val(),i=$("#editPhoneNumber").val(),r=$("#editEmail").val(),u=$("#editPassword").val(),f={Id:id,DisplayName:n,UserName:t,sdt:i,Email:r};$.ajax({url:"/admin/account/update",data:{models:JSON.stringify(f),password:u},type:"post",dataType:"json",success:function(n){n.status?(rolesScripts.loadData(!0),toastr.success(n.message)):$.each(n.errors,function(n,t){toastr.error(t)})}})},loadData:function(n){var t=$("#txtSearch").val();$.ajax({url:"/admin/role/getdata",type:"post",data:{filter:t,page:config.pageIndex,pageSize:config.pageSize},dataType:"json",success:function(t){var r;if(t.status){var u=t.data,i="",f=$("#data-template").html();$.each(u,function(n,t){i+=Mustache.render(f,{Id:t.id,DisplayName:t.displayName,UserName:t.userName,Email:t.email,Point:t.points.toLocaleString("vi",{style:"currency",currency:"VND"}),PhoneNumber:t.sdt,TrangThai:t.trangThai?" <a href='#' class='btn-active badge bg-green' data-id='"+t.id+"'><i class='fa fa-check' disabled>Đã nạp<\/i><\/a>":"<a href='#' class='btn-active badge bg-red' data-id='"+t.id+"'><i class='fa fa-ban'>Chưa nạp<\/i><\/a>"})});$("#tbData").html(i);rolesScripts.registerEvent();r=Math.ceil(t.total/config.pageSize);t.total<=config.pageSize?$(".paging-area").hide():rolesScripts.paging(t.total,function(){rolesScripts.loadData();$("#currentpage").html(config.pageIndex);$("#totalpage").html(r)},n)}}})},paging:function(n,t,i){var r=Math.ceil(n/config.pageSize);($("#pagination a").length===0||i===!0)&&($("#pagination").empty(),$("#pagination").removeData("twbs-pagination"),$("#pagination").unbind("page"));$("#pagination").twbsPagination({totalPages:r,first:"Đầu",prev:"Trước",next:"Tiếp ",last:"Cuối",visiblePages:10,onPageClick:function(n,i){config.pageIndex=i;setTimeout(t,200)}})}};rolesScripts.Init();