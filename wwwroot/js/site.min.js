var variant={warenty:0,price:0,unitPrice:0,required:0},site={init:function(){site.registerEvent();site.setDefaultText();site.getCard()},registerEvent:function(){$(".modal").modal();$(".slider").slider();$(".carousel-control-next").click(function(n){n.preventDefault();n.stopPropagation();$(".slider").slider("next")});$(".carousel-control-prev").click(function(n){n.preventDefault();n.stopPropagation();$(".slider").slider("prev")});$(".tabs").tabs();$(".sidenav").sidenav();$(".parallax").parallax();$("select").formSelect();$(".phone-format").keypress(function(n){if(n.which!==8&&n.which!==0&&(n.which<48||n.which>57))return!1;var i=this.value.length,t=$(this).val();i===3&&t.indexOf("(")<=-1?$(this).val("("+t+")-"):i===4&&t.indexOf("(")>-1?$(this).val(t+")-"):i===5&&t.indexOf(")")>-1?$(this).val(t+"-"):i===9&&($(this).val(t+"-"),$(this).attr("maxlength","14"))});$("#frm-buy-card").validate({errorElement:"span",errorClass:"error",rules:{Warenty:{required:!0},Phone:{required:!0},Email:{required:!0,email:!0}},messages:{Warenty:{required:"Yêu cầu chọn số lượng thẻ!"},Phone:{required:"Yêu cầu nhập số điện thoại!"},Email:{required:"Yêu cầu nhập email ",email:"Địa chỉ email không hợp lệ"}}});$("#frm_feedback").validate({errorElement:"span",errorClass:"error",rules:{fullName:{required:!0},email:{required:!0,email:!0},Subject:{required:!0},content:{minlength:10}},messages:{fullName:{required:"Yêu cầu nhập tên bạn"},email:{required:"Yêu cầu nhập email",email:"Địa chỉ email không hợp lệ"},Subject:{required:"Yêu cầu nhập tiêu đề"},content:{minLength:"Nội dung phải tối thiểu 10 ký tự"}}});$("#btn_buy").off("click").on("click",function(){var n=$("#userId").data("id");if(n===""||n===undefined)M.toast({html:"Opp! Bạn vui lòng đăng nhập hoặc đăng ký để tiếp tục",classes:"rounded  orange lighten-1"});else{var i=$(".list-card-items > .card-active").length,r=$(".list-price-items > .price-active").length,t=$("#selectWarenty").val();if(status=!1,i>0)if(t===null?M.toast({html:"Chọn số lượng thẻ cào!",classes:"rounded  orange lighten-1"}):status=!0,r>0){if($("#frm-buy-card").valid()&&status==="true"){var u=$(".list-price-items > .price-active").data("id"),f=$("#selectRequired").val(),e=t;site.checkTKAccount(u,f,e)}}else M.toast({html:"Vui lòng chọn mệnh giá thẻ cào",classes:"rounded  orange lighten-1"});else M.toast({html:"Vui lòng chọn một nhà mạng",classes:"rounded  orange lighten-1"})}});$("#frm_feedback").validate({errorElement:"span",errorClass:"error",rules:{fullName:{required:!0},email:{required:!0,email:!0},Subject:{required:!0},content:{minlength:10}},messages:{fullName:{required:"Yêu cầu nhập tên bạn"},email:{required:"Yêu cầu nhập email",email:"Địa chỉ email không hợp lệ"},Subject:{required:"Yêu cầu nhập tiêu đề"},content:{minLength:"Nội dung phải tối thiểu 10 ký tự"}}});$(".list-card-items >img").on("click",function(){$(".list-card-items >img").removeClass("card-active");$(this).addClass("card-active");var n=$(this).data("id"),t=$(this).attr("alt");$("#_nha_mang").empty();$("#_nha_mang").text(t);site.getPrice(n)});$(".list-price-items >a").on("click",function(n){n.preventDefault();$(".list-price-items >a").removeClass("price-active");$(this).addClass("price-active");var t=$(this).text();$("#_menh_gia").empty();$("#_menh_gia").text(t);variant.price=parseInt($(this).attr("title"));variant.unitPrice=parseInt($(this).children().val());variant.required=$("#selectRequired").val();site.getTotalPrice(variant.warenty,variant.unitPrice,variant.price)});$("#selectWarenty").on("change",function(){$("#_so_luong_the").empty();$("#_so_luong_the").text($(this).val());variant.warenty=$(this).val();variant.required=$("#selectRequired").val();site.getTotalPrice(variant.warenty,variant.unitPrice,variant.price)});$("#txtEmail").on("change",function(){$("#_email").empty();$("#_email").text($(this).val())});$("#selectRequired").on("change",function(){$("#_required").empty();variant.required=$(this).val();site.getTotalPrice(variant.warenty,variant.unitPrice,variant.price)});$("#txtPhone").on("change",function(){$("#_so_dien_thoai").empty();$("#_so_dien_thoai").text($(this).val())});$(".btn-feeback").off("click").on("click",function(){$("#frm_feedback").valid()&&site.sendFeedback()})},verifyRecapcha:function(){var n=$("#g-recaptcha-response").val();n===""?alert("Hãy xác thực Captcha"):$.ajax({async:!1,url:"/api/captcha/verify",method:"POST",data:{captchaResponse:n},success:function(n){n.success===!0?site.addNopCard():alert("Xác thực captcha không thành công \n")},error:function(){alert("captcha verification NOT successful")}})},sendFeedback:function(){var n={Name:$("#txtName").val(),Phone:$("#txtPhone").val(),Email:$("#txtemail").val(),Subject:$("#txtSubject").val(),Message:$("#txtContent").val()};$.ajax({url:"/page/PostFeedback",data:{feedback:JSON.stringify(n)},type:"post",dataType:"json",success:function(n){n.status===!0&&(M.toast({html:n.message,classes:"rounded light-blue lighten-2"}),site.resetFeedback())}})},addNopCard:function(){var n=$("#g-recaptcha-response").val(),t={cardId:$(".list-card-items >.card-active").data("id"),menhgiaId:$(".list-price-items > .price-active").data("id"),warenty:$("#selectWarenty").val(),email:$("#txtEmail").val(),required:$("#selectRequired").val(),phone:$("#txtPhone").val(),NoiDung:$("#txtDescription").val()};$.ajax({url:"/card/buycard",data:{form:JSON.stringify(t),captchaResponse:n},type:"post",dataType:"json",success:function(n){n.status===!0?M.toast({html:n.message,classes:"rounded light-blue lighten-2"}):M.toast({html:n.message,classes:"rounded red"})}})},getTotalPrice:function(n,t,i){if(n!==0&&i!==0){var r=n*i,u=n*t,f=r*variant.required,e=u+f;$("#_totalPrice,#_totalUnitPrice").empty();$("#_required").html(f.toLocaleString("it-IT",{style:"currency",currency:"VND"}));$("#_totalPrice").html(r.toLocaleString("it-IT",{style:"currency",currency:"VND"}));$("#_totalUnitPrice").html(u.toLocaleString("it-IT",{style:"currency",currency:"VND"}));$("#_total").html(e.toLocaleString("it-IT",{style:"currency",currency:"VND"}));$("#_total").attr("title",e)}},getCard:function(){$.ajax({url:"/card/getcard",type:"get",dataType:"json",success:function(n){if(n.data!==null)$.each(n.data,function(n,t){var i='<img src="'+t.thumbNail+'" class="img-responsive " alt="'+t.name+'" data-id="'+t.id+'" />';$(".list-card-items").append(i)});else $(".list-card-items").append("<p>Không có thẻ cào nào<\/p>");site.registerEvent()}})},getPrice:function(n){$.ajax({url:"/card/getPrice",data:{cardId:n},type:"get",dataType:"json",success:function(n){n.data!==null&&($(".list-price-items >a").remove(),$.each(n.data,function(n,t){var i=' <a href="#" data-id='+t.id+" title="+t.price+">"+t.price.toLocaleString("it-IT",{style:"currency",currency:"VND"})+"<input type='hidden' name = 'unitPrice' class='unitPrice' value = '"+t.unit_Price+"' /><\/a>";$(".list-price-items").append(i)}),$(".price").removeClass("hidden"));site.registerEvent()}})},setDefaultText:function(){$("#_nha_mang").text("_____");$("#_so_luong_the").text("_____");$("#_so_luong_the").text("_____");$("#_menh_gia").text("_____");$("#_so_dien_thoai").text("_____");$("#_email").text("_____")},resetFeedback:function(){$("#txtName").val("");$("#txtemail").val("");$("#txtPhone").val("");$("#txtSubject").val("");$("#txtContent").val("")},checkTKAccount:function(n,t,i){$.ajax({url:"/card/checkTKAccount",type:"post",data:{menhgiaId:n,required:t,soluong:i},dataType:"json",success:function(n){n.result?site.verifyRecapcha():(M.toast({html:"Tài khoản không đủ để thực hiện giao dịch!",classes:"rounded  orange lighten-1"}),window.open("/giao-dich/nap-tien","_blank"))}})}};site.init();