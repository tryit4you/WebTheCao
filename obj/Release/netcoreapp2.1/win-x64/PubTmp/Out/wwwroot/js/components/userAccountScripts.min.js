var config={pageSize:12,pageIndex:1},userAccountScripts={Init:function(){userAccountScripts.registerEvent()},registerEvent:function(){function u(i){if(i.files&&i.files[0]){var r=new FileReader;r.onload=function(i){$("#upload-demo").addClass("ready");t=i.target.result;n.croppie("bind",{url:t}).then(function(){console.log("jQuery bind complete");$(".crop-avatar").removeClass("hidden")})};r.readAsDataURL(i.files[0])}else swal("Sorry - you're browser doesn't support the FileReader API")}$(".modal").modal();$("#emailRegister").keypress(function(n){if($("registerEmailForm").valid()&&n.keyCode===13){var t=$("#emailRegister").val();userAccountScripts.UploadEmailRegister(t)}});$("#register-form").validate({errorElement:"span",errorClass:"error",rules:{register_username:{required:!0,minlength:4},register_email:{required:!0,email:!0},register_phone:{required:!0},register_password:{required:!0,minlength:8}},messages:{register_username:{required:"Tên tài khoản không được trống",minlength:"Tên tài khoản phải ít nhất 4 ký tự"},register_email:{required:"Yêu cầu nhập email",email:"Địa chỉ email không hợp lệ"},register_phone:{required:"Yêu cầu nhập số điện thoại"},register_password:{required:"Yêu cầu nhập mật khẩu",minlength:"Mật khẩu ít nhất 8 ký tự"}}});$("#registerEmailForm").validate({rules:{EMAIL:{required:!0,email:!0}},messages:{EMAIL:{required:"Yêu cầu nhập email",email:"Địa chỉ email không hợp lệ"}}});$("#frmEditAccount").validate({errorElement:"span",errorClass:"error",rules:{Name:{required:!0,minlength:8},Phone:{required:!0},Email:{required:!0,email:!0}},messages:{Name:{required:"Vui lòng điền tên",minlength:"Tên phải chứa ít nhất 8 ký tự"},Phone:{required:"Vui lòng điền số điện thoại"},Email:{required:"Vui lòng điền email",email:"Địa chỉ email không hợp lệ"}}});$(".btnUpdate").off("click").on("click",function(){$("#frmEditAccount").valid()&&userAccountScripts.updateAccount()});$("#lost-form").validate({errorElement:"span",errorClass:"error",rules:{lost_email:{required:!0,email:!0}},messages:{lost_email:{required:"Yêu cầu nhập email",email:"Địa chỉ email không hợp lệ"}}});$("#btn-login").on("click",function(n){n.preventDefault();var t=$("#login_username").val(),i=$("#login_password").val(),r=$("#rememberMe").prop("checked");userAccountScripts.login(t,i,r)});$("#btn-register").off("click").on("click",function(n){if(n.preventDefault(),$("#register-form").valid()){var t=$("#register_username").val(),i=$("#register_email").val(),r=$("#register_phone").val(),u=$("#register_password").val(),f={UserName:t,Email:i,PhoneNumber:r,Password:u};userAccountScripts.register(f)}});$("#forgot-password-btn").off("click").on("click",function(){var n=$("#lost_email").val();$("#lost-form").valid()&&userAccountScripts.resetPassword(n)});$(".btnUpload").off("click").on("click",function(){$("#frmEbook").valid()&&userAccountScripts.Post()});$(".btnEdit").off("click").on("click",function(){$("#editModal").modal("show")});$("#btn-Feedback").on("click",function(){$("#frmFeedback").valid()&&userAccountScripts.sendFeedback()});$(".btnSave").off("click").on("click",function(){$("#frmEdit").valid()&&userAccountScripts.SaveChange()});var n,r,t,i;n=$("#upload-demo").croppie({viewport:{width:200,height:200,type:"circle"},boundary:{width:300,height:300},enforceBoundary:!1,enableExif:!0});$(".upload-avatar").on("change",function(){i=$(this).data("id");r=$(this).val();$("#cancelCropBtn").data("id",i);u(this)});$("#cropImageBtn").on("click",function(){n.croppie("result",{type:"base64"}).then(function(n){$("#item-img-output").attr("src",n);var t=$("#txtId").val();$.ajax({url:"/useraccount/uploadAvatar",data:{image:n,userid:t},type:"post",dataType:"json",success:function(n){n.status&&(location.reload(),M.toast({html:"Cập nhật hình đại diện thành công",classes:"rounded light-blue accent-2"}))}})})});$(function(){function n(n,t){var i=n.height()+20,r=t.height()+60;$("#register_username").val("");$("#register_email").val("");$("#register_password").val("");f.css("height",i);n.fadeToggle(u,function(){f.animate({height:r},u,function(){t.fadeToggle(u)})})}function o(n,t){n.fadeOut(e,function(){$(this).text(t).fadeIn(e)})}var t=$("#login-form"),i=$("#lost-form"),r=$("#register-form"),f=$("#div-forms"),u=300,e=150,s=2e3;$("#login_register_btn").click(function(){n(t,r)});$("#register_login_btn").click(function(){n(r,t)});$("#login_lost_btn").click(function(){n(t,i)});$("#lost_login_btn").click(function(){n(i,t)});$("#lost_register_btn").click(function(){n(i,r)});$("#register_lost_btn").click(function(){n(r,i)})})},UploadEmailRegister:function(n){$.ajax({url:"/emailregister/upload",data:{email:n},type:"post",dataType:"json",success:function(){}})},SaveChange:function(){var n=$("#txtId").val(),t=$("#txtName").val(),i=$("#txtAddress").val(),r=$("#txtPhoneNumber").val(),u={Id:n,DisplayName:t,Address:i,PhoneNumber:r};$.ajax({url:"/UserAccount/UpdateUser",data:{user:JSON.stringify(u)},type:"post",dataType:"json",success:function(n){n.status?($("#editModal").modal("hide"),location.reload(),console.log(n.message)):console.log("lỗi cập nhật!!!")}})},resetPassword:function(n){$.ajax({url:"/UserAccount/SendPasswordResetLink",data:{email:n},type:"post",dataType:"json",success:function(n){status?($("#error-rs").html(n.message),$("#error-rs").delay(500).fadeIn(),$("#error-rs").delay(2e3).fadeOut()):$("#error-rs").html(n.message)}})},register:function(n){var t=JSON.stringify(n);$.ajax({url:"/UserAccount/Register",data:{models:t},type:"post",dataType:"json",success:function(n){var i=$("#validate-register"),t;i.html("");n.status===!0?M.toast({html:n.message,classes:"rounded light-blue accent-2"}):(t=n.message,$.each(t,function(n){M.toast({html:t[n],classes:"rounded deep-orange lighten-2"})}))}})},login:function(n,t,i){$.ajax({url:"/UserAccount/Login",data:{userName:n,password:t,rememberMe:i},type:"post",dataType:"json",success:function(n){n.status===!0?(M.toast({html:n.message,classes:"rounded light-blue accent-2"}),setTimeout(2e3,location.reload())):M.toast({html:n.message,classes:"rounded deep-orange lighten-2"})}})},updateAccount:function(){var n=$("#txtId").val(),t=$("#displayName").val(),i=$("#phoneNumber").val(),r=$("#address").val(),u=$("#Email").val(),f={Id:n,DisplayName:t,Address:r,Email:u,PhoneNumber:i};$.ajax({url:"/UserAccount/UpdateUser",data:{user:JSON.stringify(f)},type:"post",dataType:"json",success:function(n){n.status?(M.toast({html:n.message,classes:"rounded light-blue accent-2"}),setTimeout(2e3,location.reload())):M.toast({html:n.message,classes:"rounded deep-orange lighten-2"})}})}};userAccountScripts.Init();