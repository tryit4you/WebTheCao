var config={pageSize:12,pageIndex:1,viewport:{width:189,height:245}},giaodichController={init:function(){giaodichController.loadData();giaodichController.registerEvent();giaodichController.loadAccount()},registerEvent:function(){$(".datepicker").datepicker({format:"mm/dd/yyyy"});$("#txtAccountName,#txtNoiDung").select2();$("#frmAddNew").validate({rules:{AccountName:{required:!0},price:"required",Content:"required"},messages:{AccountName:{required:"Chọn một tài khoản"},price:"Nhập số tiền cần giao dịch",Content:{required:"Chọn một nội dung giao dịch"}}});$("#btnAdd").off("click").on("click",function(){$("#frmAddNew").valid()&&giaodichController.Post()});$("#txtPrice").autoNumeric("init",{mDec:""});$("#SaveEdit").off("click").on("click",function(){$("#frmEditData").valid()&&giaodichController.Put()});$(".btn-deleteAll").off("click").on("click",function(){bootbox.confirm("Bạn có chắc chắn muốn xóa các bản ghi được chọn không?",function(n){n&&giaodichController.deleteAll()})});$(".btn-delete").off("click").on("click",function(){var n=$(this).data("id");bootbox.confirm("Bạn có chắc chắn muốn xóa danh mục này không?",function(t){t&&giaodichController.delete(n)})});$("#btn-Deletemulti").off("click").on("click",function(){bootbox.confirm("Bạn có chắc muốn xóa các bản ghi được chọn không?",function(n){n&&giaodichController.deleteMul()})});$(".btn-clear").off("click").on("click",function(){$("#txtSearch").val("");giaodichController.loadData()});$("#txtSearch").keypress(function(n){n.keyCode===13&&giaodichController.loadData(!0)});$("#selectAll").change(function(){$(".selectedItem").prop("checked",$(this).prop("checked"));$("#btn-Deletemulti").removeAttr("disabled")});$(".selectedItem").on("click",function(){$(this).attr("checked",this.checked?"":"checked")});$(".selectedItem").on("change",function(){var n=$(".selectedItem").attr("checked").length;n>1?$("#btn-Deletemulti").removeAttr("disabled"):$("#btn-Deletemulti").add("disabled")})},"delete":function(n){$.ajax({url:"/admin/giaodich/Delete",data:{id:n},type:"post",dataType:"json",success:function(){toastr.success("Xóa thành công");giaodichController.loadData(!0)}})},deleteAll:function(){var n=[];$("td input:checked").each(function(){n.push($(this).data("id"))});n.length===0?toastr.warning("Không có phần tử nào được chọn!"):$.ajax({url:"/admin/giaodich/DeleteMulti",data:{ids:n},type:"post",dataType:"json",success:function(n){n.status?(toastr.success(n.message),giaodichController.loadData(!0)):(toastr.error(n.message),giaodichController.loadData(!0))}})},loadAccount:function(){var n=$("#txtAccountName");$.ajax({url:"/admin/giaodich/getaccount",type:"post",dataType:"json",success:function(t){var i=t.data;$(i).each(function(t,i){n.append($("<option/>",{value:i.id,text:i.userName+" --Tk chính: "+i.taiKhoanChinh.toLocaleString("it-IT",{style:"currency",currency:"VND"})}))})}})},Post:function(){var n=$("#txtAccountName").val(),t=$("#txtPrice").val(),i=$("#txtNoiDung").val(),r=$("#txtNotes").val(),u={UserId:n,Content:i,SoTien:t,Notes:r};$.ajax({url:"/admin/giaodich/Post",data:{giaodich:JSON.stringify(u)},type:"post",dataType:"json",success:function(n){n.status?(location.reload(),toastr.success(n.message)):toastr.error(n.message)}})},loadData:function(n){var t=$("#txtSearch").val();$.ajax({url:"/admin/giaodich/AllGiaoDich",type:"post",data:{filter:t,page:config.pageIndex,pageSize:config.pageSize},dataType:"json",success:function(t){var u;if(t.status){var i=t.data,r="",f=$("#data-template").html();$.each(i,function(n,t){r+=Mustache.render(f,{Id:t.id,UserName:t.userName,PhoneNumber:t.phoneNumber,NoiDung:t.content?"Nạp tiền vào tài khoản":"Trừ tiền tài khoản",NgayGiaoDich:t.createdDate,TongGiaoDich:t.soTien.toLocaleString("it-IT",{style:"currency",currency:"VND"}),GhiChu:t.notes})});i.length===0?$("#tbData").append("<tr rowspan='8'>Khong co ban ghi nao!<\/tr>"):$("#tbData").html(r);u=Math.ceil(t.total/config.pageSize);giaodichController.paging(t.total,function(){giaodichController.loadData();$("#currentpage").html(config.pageIndex);$("#totalpage").html(u)},n);giaodichController.registerEvent()}}})},paging:function(n,t,i){var r=Math.ceil(n/config.pageSize);($("#pagination a").length===0||i===!0)&&($("#pagination").empty(),$("#pagination").removeData("twbs-pagination"),$("#pagination").unbind("page"));$("#pagination").twbsPagination({totalPages:r,first:"Đầu",prev:"Trước",next:"Tiếp ",last:"Cuối",visiblePages:10,onPageClick:function(n,i){config.pageIndex=i;setTimeout(t,200)}})}};giaodichController.init();