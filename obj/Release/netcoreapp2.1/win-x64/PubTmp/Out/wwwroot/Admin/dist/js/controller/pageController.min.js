"use strict";var pageController={init:function(){pageController.loadData();pageController.registerEvent()},registerEvent:function(){$("#frmAddNew").validate({rules:{Name:"required",Content:"required"},messages:{Name:"Yêu cầu nhập tên liên hệ",Content:"Yêu cầu mã html"}});$("#frmUpdate").validate({rules:{Name:"required",EditContent:"required"},messages:{Name:"Yêu cầu nhập tên liên hệ",EditContent:"Yêu cầu mã html"}});$("#SaveEdit").off("click").on("click",function(){var n=$("#EditId").val();$("#frmUpdate").valid()&&pageController.Put(n)});$("#btnAdd").off("click").on("click",function(){if($("#frmAddNew").valid()){var n=$("#txtName").val();pageController.checkExist(n)}});$(".btn-view").off("click").on("click",function(){var n=$(this).data("id");pageController.getDetail(n)});$(".btn-edit").off("click").on("click",function(){var n=$(this).data("id");$("ul.nav.nav-tabs a:eq(2)").tab("show");pageController.loadDetail(n)});$(".btn-delete").off("click").on("click",function(){var n=$(this).data("id");bootbox.confirm("Bạn có chắc chắn muốn xóa danh mục này không?",function(t){t&&pageController.delete(n)})});$("#btn-Deletemulti").off("click").on("click",function(){bootbox.confirm("Bạn có chắc muốn xóa các bản ghi được chọn không?",function(n){n&&pageController.deleteMul()})});$("#txtSearch").change(function(){pageController.loadData(!0)});$("#btn-Search").off("click").on("click",function(){pageController.loadData(!0)});$("#btn-refresh").off("click").on("click",function(){$("#txtSearch").val("");pageController.loadData(!0)});$(".btn-active").off("click").on("click",function(n){n.preventDefault();var i=$(this).data("id"),t=$(this);$.ajax({url:"/admin/page/ChangeStatus",data:{id:i},type:"post",dataType:"json",success:function(n){n.status?(t.removeClass("bg-red"),t.addClass("bg-green"),toastr.remove(),toastr.info("Đã kích hoạt"),t.html("<i class='fa fa-check'>Active<\/i>")):(t.removeClass("bg-green"),t.addClass("bg-red"),toastr.remove(),toastr.info("Đã hủy kích hoạt"),t.html("<i class='fa fa-ban'>NotActive<\/i>"))}})});$("#selectAll").change(function(){$(".selectedItem").prop("checked",$(this).prop("checked"))})},"delete":function(n){$.ajax({url:"/admin/page/Delete",data:{id:n},type:"post",dataType:"json",success:function(n){toastr.success(n.message);pageController.loadData(!0)}})},deleteMul:function(){var n=[];$("td input:checked").each(function(){n.push($(this).data("id"))});n.length===0?toastr.info("Không có phần tử nào được chọn!"):$.ajax({url:"/admin/page/DeleteMul",data:{ids:n},type:"post",dataType:"json",success:function(n){toastr.success(n.message);pageController.loadData(!0)}})},checkExist:function(n){$.ajax({url:"/admin/page/CheckExist",data:{name:n},type:"post",dataType:"json",success:function(t){t.result===!0?pageController.Post():$(".validate").html("Tên "+n+" đã tồn tại!")}})},Post:function(){var n=$("#txtName").val(),t=$("#pageContent").val(),i=$("#txtStatus").prop("checked"),r={Name:n,Content:t,Status:i};$.ajax({url:"/admin/Page/Post",data:{page:JSON.stringify(r)},type:"post",dataType:"json",success:function(n){n.status?(location.reload(),toastr.success(n.message),pageController.loadData(!0)):toastr.error(n.message)}})},Put:function(){var n=$("#EditId").val(),t=$("#EditName").val(),i=$("#EditpageContent").val(),r=$("#EditStatus").prop("checked"),u={ID:n,Name:t,Content:i,Status:r};$.ajax({url:"/admin/page/Put",data:{page:JSON.stringify(u)},type:"post",dataType:"json",success:function(n){n.status?(location.reload(),toastr.success(n.message),pageController.loadData(!0)):toastr.error(n.message)}})},loadDetail:function(n){$.ajax({url:"/admin/Page/GetDetail",data:{id:n},type:"post",dataType:"json",success:function(n){if(n.status){var t=n.data;$("#EditId").val(t.id);$("#EditName").val(t.name);$("#EditpageContent").val(t.content);$("#EditStatus").prop("checked",t.status)}}})},getDetail:function(n){$.ajax({url:"/admin/Page/GetDetail",data:{id:n},type:"post",dataType:"json",success:function(n){if(n.status){var t=n.data;$(".btnBrowser").attr("data-id",t.id);$("#modal-title").html(t.name);$("#content").html(t.content);$("#pageViewModel").modal("show")}}})},loadData:function(){$.ajax({url:"/admin/Page/GetAll",type:"post",dataType:"json",success:function(n){if(n.status){var i=n.data,t="",r=$("#data-template").html();$.each(i,function(n,i){t+=Mustache.render(r,{ID:i.id,Name:i.name,Content:i.content,Status:i.status?"<a href='#' style='margin-top: 0%' class='btn-active badge bg-green' data-id='"+i.id+"'><i class='fa fa-check'><\/i>Active<\/a>":"<a href='#' style='margin-top: 0%' class='btn-active badge bg-red' data-id='"+i.id+"'>< i class='fa fa-ban'><\/i>NotActive<\/a>"})});$("#tbData").html(t);pageController.registerEvent()}}})}};pageController.init();