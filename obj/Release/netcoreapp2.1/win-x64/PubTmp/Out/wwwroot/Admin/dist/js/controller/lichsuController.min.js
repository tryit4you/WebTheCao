var config={pageSize:12,pageIndex:1,viewport:{width:189,height:245}},lichsuController={init:function(){lichsuController.loadData(!0)},registerEvent:function(){$("#btnThanhToan").off("click").on("click",function(n){n.preventDefault();var t=$("#hiddenId").val();$.ajax({url:"/admin/giaodich/ThanhToanThe",data:{id:t},type:"post",dataType:"json",success:function(n){n.status?(toastr.remove(),toastr.success(n.message),$("#naptheModal").modal("hide"),lichsuController.loadData(!0)):(toastr.info(n.message),$("#naptheModal").modal("hide"),lichsuController.loadData(!0))}})});$(".btn-checkInfor").off("click").on("click",function(n){n.preventDefault();var t=$(this).data("id");$.ajax({url:"/admin/giaodich/getcardinfor",data:{id:t},type:"post",dataType:"json",success:function(n){if(n.message!=="")toastr.error(n.message);else if(n.status){var t=n.data,i=t.menhGia*t.soLuong*t.required,r=t.giaChietKhau*t.soLuong+i;$("#hiddenId").val(t.id);$("#userName").html(t.userName);$("#phoneNumber").html(t.soDienThoai);$("#phidichvu").html(i.toLocaleString("vi",{style:"currency",currency:"VND"}));$("#waranty").html(t.soLuong);$("#unit_price").html(t.giaChietKhau.toLocaleString("vi",{style:"currency",currency:"VND"}));$("#createdDate").html(t.ngayNopThe);$("#typeCard").html(t.loaiThe);$("#totals").html(r.toLocaleString("vi",{style:"currency",currency:"VND"}));t.trangThai&&$("#btnThanhToan").attr("disabled","disabled");$("#naptheModal").modal("show")}else toastr.remove(),toastr.error("Không tìm thấy giao dịch này!")}})});$(".btn-delete").off("click").on("click",function(){var n=$(this).data("id");bootbox.confirm("Bạn có chắc chắn muốn xóa danh mục này không?",function(t){t&&lichsuController.delete(n)})});$("#btn-Deletemulti").off("click").on("click",function(){bootbox.confirm("Bạn có chắc muốn xóa các bản ghi được chọn không?",function(n){n&&lichsuController.deleteMul()})});$("#selectAll").change(function(){$(".selectedItem").prop("checked",$(this).prop("checked"));$("#btn-Deletemulti").removeAttr("disabled")});$(".selectedItem").on("click",function(){$(this).attr("checked",this.checked?"":"checked")});$(".selectedItem:first").on("change",function(){var n=$(".selectedItem").attr("checked").length;n>1?$("#btn-Deletemulti").removeAttr("disabled"):$("#btn-Deletemulti").add("disabled")});$(".timeRad").on("change",function(){lichsuController.loadData(!0)});$(".statusRad").on("change",function(){lichsuController.loadData(!0)});$(".statusRad").on("change",function(){lichsuController.loadData(!0)});$(".btn-search").off("click").on("click",function(){lichsuController.loadData(!0)})},"delete":function(n){$.ajax({url:"/admin/giaodich/deletehistory",data:{id:n},type:"post",dataType:"json",success:function(n){n.status?(toastr.success("Xóa thành công"),lichsuController.loadData(!0)):(toastr.success("Xóa không thành công"),lichsuController.loadData(!0))}})},deleteMul:function(){var n=[];$("td input:checked").each(function(){n.push($(this).data("id"))});n.length===0?toastr.warning("Không có phần tử nào được chọn!"):$.ajax({url:"/admin/giaodich/deleteAllHistory",data:{ids:n},type:"post",dataType:"json",success:function(n){n.status?(toastr.success(n.message),lichsuController.loadData(!0)):(toastr.error(n.message),lichsuController.loadData(!0))}})},loadData:function(n){var t=$("#txtSearch").val(),i=$("input[name=trangthainap]:checked").val();$.ajax({url:"/admin/giaodich/GetAll",type:"post",data:{filter:t,page:config.pageIndex,pageSize:config.pageSize,statusRad:i},dataType:"json",success:function(t){var r;if(t.status){var u=t.data,i="",f=$("#data-template").html();$.each(u,function(n,t){i+=Mustache.render(f,{Id:t.id,UserName:t.userName,LoaiThe:t.loaiThe,MenhGia:t.menhGia.toLocaleString("vi",{style:"currency",currency:"VND"}),NgayNopThe:t.ngayNopThe,requiredLabel:t.requiredLabel,SoDienThoai:t.soDienThoai.toLocaleString(),SoLuong:t.soLuong,TrangThai:t.trangThai?" <a href='#' class='btn-checkInfor badge bg-green' data-id='"+t.id+"'><i class='fa fa-check' >Đã nạp<\/i><\/a>":"<a href='#' class='btn-checkInfor badge bg-red' data-id='"+t.id+"'><i class='fa fa-ban'>Chưa nạp<\/i><\/a>"})});$("#tbData").html(i);lichsuController.registerEvent();r=Math.ceil(t.total/config.pageSize);t.total<=config.pageSize?$(".paging-area").hide():lichsuController.paging(t.total,function(){lichsuController.loadData();$("#currentpage").html(config.pageIndex);$("#totalpage").html(r)},n)}}})},paging:function(n,t,i){var r=Math.ceil(n/config.pageSize);($("#pagination a").length===0||i===!0)&&($("#pagination").empty(),$("#pagination").removeData("twbs-pagination"),$("#pagination").unbind("page"));$("#pagination").twbsPagination({totalPages:r,first:"Đầu",prev:"Trước",next:"Tiếp ",last:"Cuối",visiblePages:10,onPageClick:function(n,i){config.pageIndex=i;setTimeout(t,200)}})}};lichsuController.init();