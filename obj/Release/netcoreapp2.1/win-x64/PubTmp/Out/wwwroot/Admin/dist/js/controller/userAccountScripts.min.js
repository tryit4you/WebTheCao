var config={pageSize:20,pageIndex:1},userAccountScripts={Init:function(){userAccountScripts.registerEvent();userAccountScripts.loadData(!0)},registerEvent:function(){$("#frmAddNew").validate({rules:{DisplayName:{required:!0},UserName:{required:!0},PhoneNumber:{required:!0,minlength:10,number:!0},Email:{required:!0},Password:{required:!0,minlength:8},ConfirmPassword:{required:!0,equalTo:'[name="Password"]'}},messages:{DisplayName:{required:"Yêu cầu nhập họ tên"},UserName:{required:"Yêu cầu tên tài khoản"},PhoneNumber:{required:"Yêu cầu số điện thoại",minlength:"Số điện thoại ít nhất 10 ký tự",number:"Số điện thoại không đúng"},Email:{required:"Yêu cầu nhập email"},Password:{required:"Yêu cầu nhập mật khẩu",minlength:"Mật khẩu phải chứa ít nhất 8 ký tự"},ConfirmPassword:{required:"Yêu cầu nhập mật khẩu xác thực",equalTo:"Mật khẩu xác thực không trùng khớp"}}});$("#frmUpdate").validate({rules:{editDisplayName:{required:"Yêu cầu họ tên"},editUserName:{required:"Yêu cầu tên tài khoản"},editPhoneNumber:{required:"Yêu cầu số điện thoại",minlength:"Số điện thoại ít nhất 10 ký tự",number:"Số điện thoại không đúng"},editEmail:{required:"Yêu cầu nhập email"},Password:{required:!0,minlength:8},ConfirmPassword:{equalTo:"#editPassword"}},messages:{editDisplayName:{required:"Yêu cầu họ tên"},editUserName:{required:"Yêu cầu tên tài khoản"},editPhoneNumber:{required:"Yêu cầu số điện thoại",minlength:"Số điện thoại ít nhất 10 ký tự",number:"Số điện thoại không đúng"},editEmail:{required:"Yêu cầu nhập email"},Password:{required:"Yêu cầu nhập mật khẩu",minlength:"Mật khẩu ít nhất 8 ký tự"},ConfirmPassword:{equalTo:"Mật khẩu xác thực không trùng khớp"}}});$("#btnAdd").off("click").on("click",function(){$("#frmAddNew").valid()&&userAccountScripts.Post()});$(".btnEdit").off("click").on("click",function(){var n=$(this).data("id");$("ul.nav.nav-tabs a:eq(2)").tab("show");userAccountScripts.loadDetail(n)});$(".btn-band").off("click").on("click",function(n){n.preventDefault();var t=$(this).data("id"),i=$(".row_item_"+t);$.ajax({url:"/admin/account/ChangeStatus",data:{id:t},type:"post",dataType:"json",success:function(n){n.status?i.addClass("band"):i.removeClass("band");userAccountScripts.loadData(!0)}})});$("#SaveEdit").off("click").on("click",function(){$("#frmUpdate").valid()&&userAccountScripts.Put()});$("#btn-Feedback").on("click",function(){$("#frmFeedback").valid()&&userAccountScripts.sendFeedback()});$(".btnActive").off("click").on("click",function(n){n.preventDefault();var t=$(this).data("id");bootbox.confirm("Kích hoạt email cho tài khoản này?",function(n){n&&userAccountScripts.ActiveEmail(t)})});$(".btnDelete").on("click",function(n){n.preventDefault();var t=$(this).data("id");bootbox.confirm("Bạn có chắc chắn muốn xóa tài khoản này không?",function(n){n&&userAccountScripts.delete(t)})});$(".btnSave").off("click").on("click",function(){$("#frmUpdate").valid()&&userAccountScripts.SaveChange()})},"delete":function(n){$.ajax({url:"/admin/account/delete",data:{id:n},type:"post",dataType:"json",success:function(n){n.status===!0?(toastr.success(n.message),userAccountScripts.loadData(!0)):$.each(n.errors,function(n,t){toastr.error(t)})}})},ActiveEmail:function(n){$.ajax({url:"/admin/account/ActiveEmail",data:{id:n},type:"post",dataType:"json",success:function(n){n.status===!0?(toastr.success(n.message),userAccountScripts.loadData()):toastr.error(n.message)}})},loadDetail:function(n){$.ajax({url:"/admin/account/GetDetail",data:{id:n},type:"POST",dataType:"json",success:function(n){if(n.status===!0){var t=n.data;$("#EditId").val(t.id);$("#editName").val(t.displayName);$("#editUserName").val(t.userName);$("#editPhone").val(t.sdt);$("#editEmail").val(t.email)}else toastr.error(n.message),userAccountScripts.loadData(!0)}})},Post:function(){var n=$("#txtName").val(),t=$("#txtUserName").val(),i=$("#txtPhone").val(),r=$("#txtEmail").val(),u=$("#txtPassword").val(),f={DisplayName:n,UserName:t,sdt:i,Email:r};$.ajax({url:"/admin/account/create",data:{models:JSON.stringify(f),password:u},type:"post",dataType:"json",success:function(n){n.status?(userAccountScripts.loadData(!0),toastr.success(n.message)):$.each(n.data,function(n,t){toastr.error(t)})}})},Put:function(){var n=$("#EditId").val(),t=$("#editName").val(),i=$("#editUserName").val(),r=$("#editPhone").val(),u=$("#editEmail").val(),f=$("#editPassword").val(),e={Id:n,DisplayName:t,UserName:i,sdt:r,Email:u};$.ajax({url:"/admin/account/update",data:{models:JSON.stringify(e),password:f},type:"post",dataType:"json",success:function(n){n.status?(userAccountScripts.loadData(),toastr.success(n.message)):$.each(n.errors,function(n,t){toastr.error(t)})}})},loadData:function(n){var t=$("#txtSearch").val();$.ajax({url:"/admin/account/getdata",type:"post",data:{filter:t,page:config.pageIndex,pageSize:config.pageSize},dataType:"json",success:function(t){var r;if(t.status){var u=t.data,i="",f=$("#data-template").html();$.each(u,function(n,t){t.status===!1&&$(".row_item_"+t.id).addClass("band");i+=Mustache.render(f,{Id:t.id,DisplayName:t.displayName,UserName:t.userName,Email:t.emailConfirmed?"<a class='col-green ' href='#' data-id='"+t.id+"'> "+t.email+"<\/a>":"<a class='col-pink btnActive' href='#' data-id='"+t.id+"'>"+t.email+"<\/a>",Point:t.points.toLocaleString("vi",{style:"currency",currency:"VND"}),PhoneNumber:t.sdt,Status:t.status?"<a class='col-green btn-band' href='#' data-id='"+t.id+"'> <i class='fa fa-check'><\/i><\/a>":"<a class='col-pink btn-band' href='#' data-id='"+t.id+"'><i class='fa fa-ban'><\/i><\/a>"})});$("#tbData").html(i);userAccountScripts.registerEvent();r=Math.ceil(t.total/config.pageSize);t.total<=config.pageSize?$(".paging-area").hide():userAccountScripts.paging(t.total,function(){userAccountScripts.loadData();$("#currentpage").html(config.pageIndex);$("#totalpage").html(r)},n)}}})},paging:function(n,t,i){var r=Math.ceil(n/config.pageSize);($("#pagination a").length===0||i===!0)&&($("#pagination").empty(),$("#pagination").removeData("twbs-pagination"),$("#pagination").unbind("page"));$("#pagination").twbsPagination({totalPages:r,first:"Đầu",prev:"Trước",next:"Tiếp ",last:"Cuối",visiblePages:10,onPageClick:function(n,i){config.pageIndex=i;setTimeout(t,200)}})}};userAccountScripts.Init();