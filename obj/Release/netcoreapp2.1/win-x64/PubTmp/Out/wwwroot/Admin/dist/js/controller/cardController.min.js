var config={pageSize:12,pageIndex:1,viewport:{width:189,height:245}},cardController={init:function(){cardController.registerEvent()},registerEvent:function(){jQuery.validator.setDefaults({debug:!0,success:"valid"});$("#frmAddNew").validate({rules:{Name:{required:!0},Image:"required",Price:{required:!0,min:0,number:!0},UnitPrice:{required:!0,min:0,number:!0},Point:{required:!0,min:0,max:1e6,number:!0}},messages:{Name:{required:"Tên là bắt buộc"},Image:"Yêu cầu có ảnh đại diện",Price:{required:"Yêu cầu mệnh giá thẻ cào",min:"Giá trị nhỏ nhất là 0!",number:"Mệnh giá thẻ không hợp lệ!"},UnitPrice:{required:"Nhập dung lượng",min:"Số trang phải ít nhất là 0!",number:"Dung lượng không hợp lệ!"},Point:{required:"Yêu cầu nhập điểm",min:"Giá trị nhỏ nhất là 0",max:"Giá trị lớn nhất là 1000000",number:"Không đúng định dạng"}}});$("#frmUpdate").validate({rules:{EditName:{required:!0},EditImage:"required"},messages:{EditName:{required:"Tên là bắt buộc"},EditImage:"Yêu cầu có ảnh đại diện"}});$("#btnAdd").off("click").on("click",function(){$("#frmAddNew").valid()&&cardController.Post()});$(".btn-save-mg-false").off("click").on("click",function(n){n.preventDefault();var t=$(this).data("id"),i=$("#MenhGiaId-"+t+"-false").val(),r=$("#txtPrice-"+t+"-false").val(),u=$("#txtUnit_Price-"+t+"-false").val(),f=$("#txtPoints-"+t).val();r===""||u===""||f===""?toastr.info("Điền thông tin đầy đủ vào các trường!"):i!==""?cardController.PutMg(t,!1):cardController.ThemMenhGia(t,!1)});$(".btn-save-mg-true").off("click").on("click",function(n){n.preventDefault();var t=$(this).data("id"),i=$("#MenhGiaId-"+t+"-true").val(),r=$("#txtPrice-"+t+"-true").val(),u=$("#txtUnit_Price-"+t+"-true").val(),f=$("#txtPoints-"+t).val();r===""||u===""||f===""?toastr.info("Điền thông tin đầy đủ vào các trường!"):i!==""?cardController.PutMg(t,!0):cardController.ThemMenhGia(t,!0)});$("#SaveEdit").off("click").on("click",function(){$("#frmUpdate").valid()&&cardController.Put()});$(".btn-active").off("click").on("click",function(n){n.preventDefault();var i=$(this).data("id"),t=$(this);$.ajax({url:"/admin/card/ChangeStatus",data:{id:i},type:"post",dataType:"json",success:function(n){n.message===null?toastr.error(n.message):n.status?(t.removeClass("bg-red"),t.addClass("bg-green"),toastr.remove(),toastr.info("Đã kích hoạt"),t.html("<i class='fa fa-check'>Active<\/i>")):(t.removeClass("bg-green"),t.addClass("bg-red"),toastr.remove(),toastr.info("Đã hủy kích hoạt"),t.html("<i class='fa fa-ban'>NotActive<\/i>"))}})});$(".btn-edit").off("click").on("click",function(n){n.preventDefault();var t=$(this).data("id");cardController.loadDetail(t)});$(".btn-delete").off("click").on("click",function(){var n=$(this).data("id");bootbox.confirm("Bạn có chắc chắn muốn xóa danh mục này không?",function(t){t&&cardController.delete(n)})});$(".btnDelete").off("click").on("click",function(){var n=$(this).data("id");bootbox.confirm("Bạn có chắc chắn muốn xóa loại thẻ này không? ",function(t){t&&cardController.deleteCard(n)})});$("#btn-Deletemulti").off("click").on("click",function(){bootbox.confirm("Bạn có chắc muốn xóa các bản ghi được chọn không?",function(n){n&&cardController.deleteMul()})});$(".format_number").autoNumeric("init");$(".btnEditCard").off("click").on("click",function(n){n.preventDefault();var t=$(this).data("id");$("ul.nav.nav-tabs a:eq(2)").tab("show");cardController.loadCardDetail(t)});$("#dailyCheckbox").on("change",function(n){n.preventDefault();var t=$(this).data("id");cardController.loadCardDetail(t)});$("#selectAll").change(function(){$(".selectedItem").prop("checked",$(this).prop("checked"));$("#btn-Deletemulti").removeAttr("disabled")});$(".selectedItem").on("click",function(){$(this).attr("checked",this.checked?"":"checked")});$(".selectedItem").on("change",function(){var n=$(".selectedItem").attr("checked").length;n>1?$("#btn-Deletemulti").removeAttr("disabled"):$("#btn-Deletemulti").add("disabled")})},"delete":function(n){$.ajax({url:"/admin/card/DeleteMg",data:{id:n},type:"post",dataType:"json",success:function(){toastr.success("Xóa thành công");location.reload()}})},deleteCard:function(n){$.ajax({url:"/admin/card/DeleteCard",data:{id:n},type:"post",dataType:"json",success:function(){toastr.success("Xóa thành công");cardController.loadData(!0)}})},deleteMul:function(){var n=[];$("td input:checked").each(function(){n.push($(this).data("id"))});n.length===0?toastr.warning("Không có phần tử nào được chọn!"):$.ajax({url:"/admin/card/DeleteMul",data:{ids:n},type:"post",dataType:"json",success:function(n){n.status?(toastr.success(n.message),cardController.loadData(!0)):(toastr.error(n.message),cardController.loadData(!0))}})},loadDetail:function(n){$.ajax({url:"/admin/card/GetMgDetail",data:{id:n},type:"POST",dataType:"json",success:function(n){if(n.status===!0){var t=n.data;$("#MenhGiaId-"+t.cardId+"-"+t.daiLy).val(t.id);$("#txtPrice-"+t.cardId+"-"+t.daiLy).val(t.price);$("#txtUnit_Price-"+t.cardId+"-"+t.daiLy).val(t.unit_Price);$("#txtPoints-"+t.cardId+"-"+t.daiLy).val(t.point)}else toastr.error(n.message),cardController.loadData(!0)}})},loadCardDetail:function(n){$.ajax({url:"/admin/card/GetCardDetail",data:{id:n},type:"POST",dataType:"json",success:function(n){if(n.status===!0){var t=n.data;$("#EditId").val(t.id);$("#EditName").val(t.name);$("#EditImage").attr("src",t.thumbNail);$("#EditStatus").prop("checked",t.status)}else toastr.error(n.message),cardController.loadData(!0)}})},ThemMenhGia:function(n,t){var i=$("#txtCardId-"+n+"-"+t).data("id"),r=$("#txtPrice-"+n+"-"+t).val(),u=$("#txtUnit_Price-"+n+"-"+t).val(),f=$("#txtPoints-"+n+"-"+t).val(),e={cardId:i,Price:r,unit_Price:u,Point:f,DaiLy:t};$.ajax({url:"/admin/card/AddMenhGia",data:{mg:JSON.stringify(e)},type:"post",dataType:"json",success:function(n){n.status&&(toastr.success(n.message),location.reload())}})},Post:function(){var n=$("#txtName").val(),t=$("#txtImage").attr("src"),i=$("#txtStatus").prop("checked"),r={Name:n,thumbNail:t,Status:i};$.ajax({url:"/admin/card/post",data:{card:JSON.stringify(r)},type:"post",dataType:"json",success:function(n){n.status?(location.reload(),toastr.success(n.message)):toastr.error(n.message)}})},PutMg:function(n,t){var i=$("#MenhGiaId-"+n+"-"+t).val(),r=$("#txtCardId-"+n+"-"+t).data("id"),u=$("#txtPrice-"+n+"-"+t).val(),f=$("#txtUnit_Price-"+n+"-"+t).val(),e=$("#txtPoints-"+n+"-"+t).val(),o={Id:i,CardId:r,Price:u,unit_Price:f,Point:e,DaiLy:t};$.ajax({url:"/admin/card/PutMg",data:{mg:JSON.stringify(o)},type:"post",dataType:"json",success:function(n){n.status?(location.reload(),toastr.success(n.message)):toastr.error(n.message)}})},Put:function(){var n=$("#EditId").val(),t=$("#EditName").val(),i=$("#EditImage").attr("src"),r=$("#EditStatus").prop("checked"),u={Id:n,Name:t,thumbNail:i,status:r};$.ajax({url:"/admin/card/putcard",data:{card:JSON.stringify(u)},type:"post",dataType:"json",success:function(n){n.status?(location.reload(),toastr.success(n.message)):toastr.error(n.message)}})}};cardController.init();