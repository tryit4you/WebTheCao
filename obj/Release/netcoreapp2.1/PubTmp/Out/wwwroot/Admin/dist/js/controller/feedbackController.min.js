"use strict";var config={pageSize:20,pageIndex:1},feedbackController={init:function(){feedbackController.loadData();feedbackController.registerEvent()},registerEvent:function(){$(".btn-delete").off("click").on("click",function(){var n=$(this).data("id");bootbox.confirm("Bạn có chắc chắn muốn xóa danh mục này không?",function(t){t&&feedbackController.delete(n)})});$("#btn-Deletemulti").off("click").on("click",function(){bootbox.confirm("Bạn có chắc muốn xóa các bản ghi được chọn không?",function(n){n&&feedbackController.deleteMul()})});$("#txtSearch").keypress(function(n){n.keyCode===13&&feedbackController.loadData(!0)});$(".btn-active").off("click").on("click",function(n){n.preventDefault();var i=$(this).data("id"),t=$(this);$.ajax({url:"/admin/feedback/ChangeStatus",data:{id:i},type:"post",dataType:"json",success:function(n){n.status?(t.removeClass("label-danger"),t.addClass("label-success"),t.text("Kích hoạt")):(t.removeClass("label-success"),t.addClass("label-danger"),t.text("Khóa"))}})});$("#selectAll").change(function(){$(".selectedItem").prop("checked",$(this).prop("checked"))});$(".btn-reply").off("click").on("click",function(){var n=$(this).data("id");$.ajax({url:"/admin/Feedback/SendAsync",data:{id:n},type:"post",dataType:"json",success:function(n){n.status?bootbox.alert(n.message):bootbox.alert(n.message)}})})},deleteMul:function(){var n=[];$("td input:checked").each(function(){n.push($(this).data("id"))});n.length===0?bootbox.alert("Không có phần tử nào được chọn!"):$.ajax({url:"/admin/Feedback/DeleteMul",data:{ids:n},type:"post",dataType:"json",success:function(n){bootbox.alert(n.message,function(){feedbackController.loadData(!0)})}})},loadDetail:function(n){$.ajax({url:"/admin/Feedback/GetDetail",data:{id:n},type:"GET",dataType:"json",success:function(n){if(n.status===!0){var t=n.data;$("#txtId").val(t.ID);$("#txtName").val(t.Name);$("#txtPhone").val(t.Phone);$("#txtMessage").val(t.Message);$("#txtEmail").val(t.Email);$("#ckStatus").prop("checked",t.Status)}else bootbox.alert("Lỗi!",function(){feedbackController.loadData(!0)})}})},loadData:function(n){var t=$("#txtSearch").val(),i=$("#txtOpt").val();$.ajax({url:"/admin/Feedback/GetAll",type:"post",data:{filter:t,opt:i,page:config.pageIndex,pageSize:config.pageSize},dataType:"json",success:function(t){var r;if(t.status){var u=t.data,i="",f=$("#data-template").html();$.each(u,function(n,t){i+=Mustache.render(f,{ID:t.id,UserName:t.userName,Message:t.message,Subject:t.subject,urlAvatar:t.urlAvatar,CreateDate:t.time,status:t.status?"<span class='badge bg-green'><small>đã đọc<\/small><\/span>":"<span class='badge bg-red'><small>mới<\/small><\/span>",isWaiting:t.isWaiting?"<span class='badge bg-yellow'><small>đang chờ...<\/small><\/span>":""})});$("#tbData").html(i);r=Math.ceil(t.total/config.pageSize);feedbackController.paging(t.total,function(){feedbackController.loadData();$("#currentpage").html(config.pageIndex);$("#totalpage").html(r)},n);feedbackController.registerEvent()}}})},paging:function(n,t,i){var r=Math.ceil(n/config.pageSize);($("#pagination a").length===0||i===!0)&&($("#pagination").empty(),$("#pagination").removeData("twbs-pagination"),$("#pagination").unbind("page"));$("#pagination").twbsPagination({totalPages:r,first:"Đầu",prev:"Trước",next:"Tiếp ",last:"Cuối",visiblePages:10,onPageClick:function(n,i){config.pageIndex=i;setTimeout(t,200)}})}};feedbackController.init();