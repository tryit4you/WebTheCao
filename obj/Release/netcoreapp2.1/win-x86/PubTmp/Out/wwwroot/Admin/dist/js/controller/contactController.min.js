"use strict";var config={pageSize:20,pageIndex:1},contactController={init:function(){contactController.loadData();contactController.registerEvent()},registerEvent:function(){$("#frmAddNew").validate({rules:{Name:"required",Phone:"required",Email:"required",Address:"required",Facebook:"required",FacebookLink:"required"},messages:{Name:"Yêu cầu nhập tên liên hệ",Phone:"Yêu cầu nhập số điện thoại",Email:"Yêu cầu nhập Email",Address:"Yêu cầu nhập địa chỉ",Facebook:"Yêu cầu nhập tên fb",FacebookLink:"Yêu cầu đường dẫn đến trang cá nhân"}});$("#frmUpdate").validate({rules:{Name:"required",Phone:"required",Email:"required",Address:"required",Facebook:"required",FacebookLink:"required"},messages:{Name:"Yêu cầu nhập tên liên hệ",Phone:"Yêu cầu nhập số điện thoại",Email:"Yêu cầu nhập Email",Address:"Yêu cầu nhập địa chỉ",Facebook:"Yêu cầu nhập tên fb",FacebookLink:"Yêu cầu đường dẫn đến trang cá nhân"}});$("#SaveEdit").off("click").on("click",function(){var n=$("#txtId").val();$("#frmUpdate").valid()&&contactController.Put()});$("#btnAdd").off("click").on("click",function(){$("#frmAddNew").valid()&&contactController.Post()});$(".btn-edit").off("click").on("click",function(){var n=$(this).data("id");$("ul.nav.nav-tabs a:eq(2)").tab("show");contactController.resetForm();contactController.loadDetail(n)});$(".btn-delete").off("click").on("click",function(){var n=$(this).data("id");bootbox.confirm("Bạn có chắc chắn muốn xóa danh mục này không?",function(t){t&&contactController.delete(n)})});$("#btn-Deletemulti").off("click").on("click",function(){bootbox.confirm("Bạn có chắc muốn xóa các bản ghi được chọn không?",function(n){n&&contactController.deleteMul()})});$("#txtSearch").change(function(){contactController.loadData(!0)});$("#btn-Search").off("click").on("click",function(){contactController.loadData(!0)});$("#btn-refresh").off("click").on("click",function(){$("#txtSearch").val("");contactController.loadData(!0)});$(".btn-active").off("click").on("click",function(n){n.preventDefault();var i=$(this).data("id"),t=$(this);$.ajax({url:"/admin/contact/ChangeStatus",data:{id:i},type:"post",dataType:"json",success:function(n){n.status?(t.removeClass("bg-red"),t.addClass("bg-green"),toastr.remove(),toastr.info("Đã kích hoạt"),t.html("<i class='fa fa-check'>Active<\/i>")):(t.removeClass("bg-green"),t.addClass("bg-red"),toastr.remove(),toastr.info("Đã hủy kích hoạt"),t.html("<i class='fa fa-ban'>NotActive<\/i>"))}})});$("#selectAll").change(function(){$(".selectedItem").prop("checked",$(this).prop("checked"))})},resetForm:function(){$(".validate").html("");$("#txtId").val("");$("#txtPhone").val("");$("#txtName").val("");$("#txtEmail").val("");$("#txtWebsite").val("");$("#txtAddress").val("");$("#ckStatus").prop("checked","true")},"delete":function(n){$.ajax({url:"/admin/Contact/Delete",data:{id:n},type:"post",dataType:"json",success:function(n){toastr.success(n.message);contactController.loadData(!0)}})},deleteMul:function(){var n=[];$("td input:checked").each(function(){n.push($(this).data("id"))});n.length===0?toastr.info("Không có phần tử nào được chọn!"):$.ajax({url:"/admin/contact/DeleteMul",data:{ids:n},type:"post",dataType:"json",success:function(n){toastr.success(n.message);contactController.loadData(!0)}})},loadDetail:function(n){$.ajax({url:"/admin/Contact/GetDetail",data:{id:n},type:"POST",dataType:"json",success:function(n){if(n.status===!0){var t=n.data;$("#EditId").val(t.id);$("#EditName").val(t.name);$("#EditPhone").val(t.phoneNumber);$("#editFacebookName").val(t.facebook);$("#editFacebookLink").val(t.facebookLink);$("#editZaloName").val(t.zalo);$("#EditEmail").val(t.email);$("#EditAddress").val(t.address);$("#EditStatus").prop("checked",t.status)}else toastr.error("Lỗi!"),contactController.loadData(!0)}})},Post:function(){var n=$("#txtPhone").val(),t=$("#txtEmail").val(),i=$("#txtFacebookName").val(),r=$("#txtFacebookLink").val(),u=$("#txtZaloName").val(),f=$("#txtAddress").val(),e=$("#txtStatus").prop("checked"),o={PhoneNumber:n,Email:t,Facebook:i,FacebookLink:r,Zalo:u,Address:f,Status:e};$.ajax({url:"/admin/Contact/Post",data:{contact:JSON.stringify(o)},type:"post",dataType:"json",success:function(n){n.status?(toastr.success(n.message),contactController.loadData(!0),location.reload()):toastr.error(n.message)}})},Put:function(){var n=$("#EditId").val(),t=$("#EditPhone").val(),i=$("#EditEmail").val(),r=$("#editFacebookName").val(),u=$("#editFacebookLink").val(),f=$("#editZaloName").val(),e=$("#EditAddress").val(),o=$("#EditStatus").prop("checked"),s={ID:n,PhoneNumber:t,Email:i,Facebook:r,FacebookLink:u,Zalo:f,Address:e,Status:o};$.ajax({url:"/admin/Contact/Put",data:{contact:JSON.stringify(s)},type:"post",dataType:"json",success:function(n){n.status?(location.reload(),toastr.success(n.message),contactController.loadData(!0)):toastr.error(n.message)}})},loadData:function(n){var t=$("#txtSearch").val();$.ajax({url:"/admin/Contact/GetAll",type:"POST",data:{filter:t,page:config.pageIndex,pageSize:config.pageSize},dataType:"json",success:function(t){var r;if(t.status){var u=t.data,i="",f=$("#data-template").html();$.each(u,function(n,t){i+=Mustache.render(f,{ID:t.id,Phone:t.phoneNumber,Email:t.email,Facebook:t.facebook,FacebookLink:t.facebookLink,Zalo:t.zalo,Address:t.address,Status:t.status?"<a href='#' class='btn-active badge bg-green' data-id='"+t.id+"'><i class='fa fa-check'>Active<\/i><\/a>":"<a href='#' class='btn-active badge bg-red' data-id='"+t.id+"'>< i class='fa fa-ban'>NotActive<\/i><\/a>"})});$("#tbData").html(i);r=Math.ceil(t.total/config.pageSize);contactController.paging(t.total,function(){contactController.loadData();$("#currentpage").html(config.pageIndex);$("#totalpage").html(r)},n);contactController.registerEvent()}}})},paging:function(n,t,i){var r=Math.ceil(n/config.pageSize);($("#pagination a").length===0||i===!0)&&($("#pagination").empty(),$("#pagination").removeData("twbs-pagination"),$("#pagination").unbind("page"));$("#pagination").twbsPagination({totalPages:r,first:"Đầu",prev:"Trước",next:"Tiếp ",last:"Cuối",visiblePages:10,onPageClick:function(n,i){config.pageIndex=i;setTimeout(t,200)}})}};contactController.init();