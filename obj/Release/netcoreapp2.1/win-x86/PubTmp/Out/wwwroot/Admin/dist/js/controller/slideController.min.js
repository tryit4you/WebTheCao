"use strict";var config={pageSize:20,pageIndex:1},slideController={init:function(){slideController.loadData();slideController.registerEvent()},registerEvent:function(){$("#frmAddNew").validate({rules:{Name:"required",Image:"required",Content:"required",Author:"required"},messages:{Name:"Tên là bắt buộc",Image:"Yêu cầu phải có hình ảnh",Content:"Yêu cầu nội dung",Author:"Yêu cầu tác giả"}});$("#frmUpdate").validate({rules:{EditName:"required",EditImage:"required",EditContent:"required",EditAuthor:"required"},messages:{EditName:"Tên là bắt buộc",EditImage:"Yêu cầu phải có hình ảnh",EditContent:"Yêu cầu nội dung",EditAuthor:"Yêu cầu tác giả"}});$("#btnAdd").off("click").on("click",function(){if($("#frmAddNew").valid()){var n=$("#txtName").val();slideController.checkExist(n)}});$("#SaveEdit").off("click").on("click",function(){$("#frmUpdate").valid()&&slideController.Put()});$(".btn-edit").off("click").on("click",function(){var n=$(this).data("id");$("ul.nav.nav-tabs a:eq(2)").tab("show");slideController.resetForm();slideController.loadDetail(n)});$("#txtDisplayOrder").on("change",function(){var t=$(this).data("id"),n=$(this).val();parseInt(n)<0&&(toastr.warning("Gía trị không được nhỏ hơn 0"),$(this).val("0"))});$(".btn-delete").off("click").on("click",function(){var n=$(this).data("id");bootbox.confirm("Bạn có chắc chắn muốn xóa danh mục này không?",function(t){t&&slideController.delete(n)})});$("#btn-Deletemulti").off("click").on("click",function(){bootbox.confirm("Bạn có chắc muốn xóa các bản ghi được chọn không?",function(n){n&&slideController.deleteMul()})});$("#txtSearch").change(function(){slideController.loadData(!0)});$("#btn-Search").off("click").on("click",function(){slideController.loadData(!0)});$("#btn-refresh").off("click").on("click",function(){$("#txtSearch").val("");slideController.loadData(!0)});$(".btn-active").off("click").on("click",function(n){n.preventDefault();var i=$(this).data("id"),t=$(this);$.ajax({url:"/admin/slide/ChangeStatus",data:{id:i},type:"post",dataType:"json",success:function(n){n.message===null?toastr.error(n.message):n.status?(t.removeClass("label-danger"),t.addClass("label-success"),toastr.remove(),toastr.info("Đã kích hoạt"),t.html("<i class='fa fa-check'><\/i>")):(t.removeClass("label-success"),t.addClass("label-danger"),toastr.remove(),toastr.info("Đã hủy kích hoạt"),t.html("<i class='fa fa-ban'><\/i>"))}})});$(".btn-Choose").off("click").on("click",function(n){n.preventDefault();var i=$(this).data("id"),t=$(this);$.ajax({url:"/admin/slide/ChooseImage",data:{id:i},type:"post",dataType:"json",success:function(n){n.message===null?toastr.error(n.message):n.status?(t.removeClass("label-danger"),t.addClass("label-success"),toastr.remove(),toastr.info("Đã chọn"),t.html("<i class='fa fa-check'><\/i>")):(t.removeClass("label-success"),t.addClass("label-danger"),toastr.remove(),toastr.info("Đã hủy chọn"),t.html("<i class='fa fa-ban'><\/i>"))}})})},updateOrder:function(n,t){$.ajax({url:"/admin/Slide/UpdateOrder",data:{id:n,DisplayOrder:t},type:"post",dataType:"json",success:function(n){n.result?toastr.success(n.message):toastr.error(n.message)}})},resetForm:function(){$(".validate").html("");$("#txtId").val("");$("#txtDescription").val("");$("#txtContent").val("");$("#txtName").val("");$("#txtLink").val("");$("#txtImages").val("");$("#txtImg").attr("src","");$("#txtDisplayOrder").val("0");$("#ckStatus").prop("checked","true")},"delete":function(n){$.ajax({url:"/admin/Slide/Delete",data:{id:n},type:"post",dataType:"json",success:function(n){toastr.success(n.message);slideController.loadData(!0)}})},deleteMul:function(){var n=[];$("td input:checked").each(function(){n.push($(this).data("id"))});n.length===0?toastr.warning("Không có phần tử nào được chọn!"):$.ajax({url:"/admin/Slide/DeleteMul",data:{ids:n},type:"post",dataType:"json",success:function(n){toastr.success(n.message);slideController.loadData(!0)}})},checkExist:function(n){$.ajax({url:"/admin/Slide/CheckExist",data:{name:n},type:"post",dataType:"json",success:function(t){t.result===!0?slideController.Post():$(".validate").html("Tên "+n+" đã tồn tại!")}})},loadDetail:function(n){$.ajax({url:"/admin/slide/GetDetail",data:{id:n},type:"post",dataType:"json",success:function(n){if(n.status===!0){var t=n.data;$("#EditId").val(t.id);$("#EditName").val(t.name);$("#EditThumbnail").attr("src",t.image);tinymce.get("EditContent").setContent(t.content);$("#EditDisplayOrder").val(t.displayOrder);$("#EditAuthor").val(t.authors);$("#EditChoose").prop("checked",t.isChoose);$("#EditStatus").prop("checked",t.status)}else toastr.error("Lỗi!"),slideController.loadData(!0)}})},Post:function(){var n=$("#txtName").val(),t=$("#ImgThumbnail").attr("src"),i=tinymce.get("txtContent").getContent(),r=$("#txtDisplayOrder").val(),u=$("#txtAuthor").val(),f=$("#txtStatus").prop("checked"),e=$("#txtChoose").prop("checked"),o={Name:n,Image:t,Content:i,Authors:u,DisplayOrder:r,IsChoose:e,Status:f};$.ajax({url:"/admin/Slide/Post",data:{slide:JSON.stringify(o)},type:"post",dataType:"json",success:function(n){n.status?(location.reload(),toastr.success(n.message),slideController.loadData(!0)):toastr.error(n.message)}})},Put:function(){var n=$("#EditId").val(),t=$("#EditName").val(),i=$("#EditThumbnail").attr("src"),r=tinymce.get("EditContent").getContent(),u=$("#EditDisplayOrder").val(),f=$("#EditAuthor").val(),e=$("#EditStatus").prop("checked"),o=$("#EditChoose").prop("checked"),s={Id:n,Name:t,Image:i,Content:r,DisplayOrder:u,Authors:f,IsChoose:o,Status:e};$.ajax({url:"/admin/Slide/Put",data:{slide:JSON.stringify(s)},type:"post",dataType:"json",success:function(n){n.status?(toastr.success(n.message),slideController.loadData(!0)):toastr.error(n.message)}})},loadData:function(n){var t=$("#txtSearch").val();$.ajax({url:"/admin/Slide/GetAll",type:"post",data:{filter:t,page:config.pageIndex,pageSize:config.pageSize},dataType:"json",success:function(t){var r;if(t.status){var u=t.data,i="",f=$("#data-template").html();$.each(u,function(n,t){i+=Mustache.render(f,{ID:t.id,Name:t.name,Image:t.image,Content:t.content,DisplayOrder:t.displayOrder,Link:t.url,Status:t.status?" <a href='#' class='btn-active label-success' data-id='"+t.id+"'><i class='fa fa-check'><\/i><\/a>":"<a href='#' class='btn-active label-danger' data-id='"+t.id+"'><i class='fa fa-ban'><\/i><\/a>",DisplayImage:t.isChoose?" <a href='#' class='btn-Choose label-success' data-id='"+t.id+"'><i class='fa fa-check'><\/i><\/a>":"<a href='#' class='btn-Choose label-danger' data-id='"+t.id+"'><i class='fa fa-ban'><\/i><\/a>"})});$("#tbData").html(i);r=Math.ceil(t.total/config.pageSize);slideController.paging(t.total,function(){slideController.loadData();$("#currentpage").html(config.pageIndex);$("#totalpage").html(r);$("#row_item").html(t.total)},n);slideController.registerEvent()}}})},paging:function(n,t,i){var r=Math.ceil(n/config.pageSize);($("#pagination a").length===0||i===!0)&&($("#pagination").empty(),$("#pagination").removeData("twbs-pagination"),$("#pagination").unbind("page"));$("#pagination").twbsPagination({totalPages:r,first:"Đầu",prev:"Trước",next:"Tiếp ",last:"Cuối",visiblePages:10,onPageClick:function(n,i){config.pageIndex=i;setTimeout(t,200)}})}};slideController.init();