var config={pageSize:12,pageIndex:1},userAccountScripts={Init:function(){userAccountScripts.registerEvent()},registerEvent:function(){$("#txtBookCategory").select2();$("#txtBookType").select2();$(".Language").select2();$("#register-form").validate({rules:{register_username:{required:!0,minlength:8},register_email:{required:!0,email:!0},register_password:{required:!0,minlength:8}},messages:{register_username:{required:"Tên tài khoản không được trống",minlength:"Tên tài khoản phải ít nhất 8 ký tự"},register_email:{required:"Yêu cầu nhập email",email:"Địa chỉ email không hợp lệ"},register_password:{required:"Yêu cầu nhập mật khẩu",minlength:"Mật khẩu ít nhất 8 ký tự"}}});$("#frmFeedback").validate({rules:{name:{required:!0,minlength:8},email:{required:!0,email:!0},subject:{required:!0},message:{required:!0}},messages:{name:{required:"Yêu cầu nhập tên",minlength:"Tên phải có ít nhất 8 ký tự"},email:{required:"Yêu cầu nhập email",email:"Địa chỉ email không hợp lệ"},subject:{required:"Yêu cầu nhập chủ đề"},message:{required:"Yêu cầu nội dung"}}});$("#frmEbook").validate({rules:{Name:{required:!0,minlength:8},Image:"required",PageNumber:{required:!0,min:1,number:!0},Capacity:{required:!0,min:.1,number:!0},Authors:"required",DateRelease:{required:!0,min:1980,max:2090,number:!0},EbookCategory:"required",Description:"required",LinkPdf:{url:!0},LinkEpub:{url:!0},LinkMobi:{url:!0}},messages:{Name:{required:"Tên là bắt buộc",minlength:"Tên yêu cầu ít nhất 8 ký tự"},Image:"Yêu cầu có ảnh đại diện",PageNumber:{required:"Nhập số trang",min:"Số trang phải ít nhất là 1!",number:"Số trang không hợp lệ!"},Capacity:{required:"Nhập dung lượng",min:"Số trang phải ít nhất là 0!",number:"Dung lượng không hợp lệ!"},Authors:"Nhập tên tác giả",DateRelease:{required:"Yêu cầu nhập năm",min:"Năm lớn hơn 1980",max:"Năm nhỏ hơn 2090",number:"Yêu cầu phải là số"},EbookCategory:"Chọn một danh mục",Description:"Yêu cầu nhập mô tả",LinkPdf:{url:"Yêu cầu nhập đường dẫn hợp lệ!"},LinkEpub:{url:"Yêu cầu nhập đường dẫn hợp lệ!"},LinkMobi:{url:"Yêu cầu nhập đường dẫn hợp lệ!"}}});$("#frmEdit").validate({rules:{Name:{required:!0,minlength:8}},messages:{Name:{required:"Vui lòng điền tên",minlength:"Tên phải chứa ít nhất 8 ký tự"}}});$("#lost-form").validate({rules:{lost_email:{required:!0,email:!0}},messages:{lost_email:{required:"Yêu cầu nhập email",email:"Địa chỉ email không hợp lệ"}}});$("#btn-login").on("click",function(n){n.preventDefault();var t=$("#login_username").val(),i=$("#login_password").val(),r=$("#rememberMe").prop("checked");userAccountScripts.login(t,i,r)});$("#btn-register").off("click").on("click",function(n){if(n.preventDefault(),$("#register-form").valid()){var t=$("#register_username").val(),i=$("#register_email").val(),r=$("#register_password").val(),u={UserName:t,Email:i,Password:r};userAccountScripts.register(u)}});$("#forgot-password-btn").off("click").on("click",function(){var n=$("#lost_email").val();$("#lost-form").valid()&&userAccountScripts.resetPassword(n)});$(".btnUpload").off("click").on("click",function(){if($("#frmEbook").valid()){var n=$("#txtName").val();userAccountScripts.checkExist(n)}});$(".btnEdit").off("click").on("click",function(){$("#editModal").modal("show")});$("#btn-Feedback").on("click",function(){$("#frmFeedback").valid()&&userAccountScripts.sendFeedback()});$(".btnSave").off("click").on("click",function(){$("#frmEdit").valid()&&userAccountScripts.SaveChange()});$("#txtBookCategory").on("change",function(){var n=$(this).val();n!==null&&userAccountScripts.loadTypeByCategory(n)});$(function(){function n(n,t){var i=n.height()+20,r=t.height()+60;f.css("height",i);n.fadeToggle(u,function(){f.animate({height:r},u,function(){t.fadeToggle(u)})})}function o(n,t){n.fadeOut(e,function(){$(this).text(t).fadeIn(e)})}var t=$("#login-form"),i=$("#lost-form"),r=$("#register-form"),f=$("#div-forms"),u=300,e=150,s=2e3;$("#login_register_btn").click(function(){n(t,r)});$("#register_login_btn").click(function(){n(r,t)});$("#login_lost_btn").click(function(){n(t,i)});$("#lost_login_btn").click(function(){n(i,t)});$("#lost_register_btn").click(function(){n(i,r)});$("#register_lost_btn").click(function(){n(r,i)})})},checkExist:function(n){$.ajax({url:"/Books/CheckExist",data:{name:n},type:"post",dataType:"json",success:function(t){t.result===!0?userAccountScripts.Post():$(".validate").html("Tên "+n+" đã tồn tại!")}})},loadTypeByCategory:function(n){var t=$("#txtBookType");$.ajax({url:"/Books/getbycategory",type:"get",data:{categoryId:n},dataType:"json",success:function(n){if(n.status){t.empty();var i=n.data;$(i).each(function(n,i){t.append($("<option/>",{value:i.id,text:i.name}))})}}})},Post:function(){var t=$("#txtName").val(),i=commonController.getSeoTitle(t),r=$("#txtBookType").val(),u=$("#txtBookCategory").val(),f=$("#ImgThumbnail").attr("src"),e=tinymce.get("txtContent").getContent(),o=$(".Language").val(),s=$("#txtPageNumber").val(),h=$("#txtCapacity").val(),c=$("#txtAuthors").val(),l=$("#txtPublishBy").val(),a=$("#txtDateRelease").val(),v=$("#txtReferenceText").val(),y=$("#txtReferenceLink").val(),p=$("#txtLinkPdf").val(),w=$("#txtLinkEpub").val(),b=$("#txtLinkMobi").val(),n={PdfLink:p,EpubLink:w,MobiLink:b},k={Name:t,Language:o,PageNumber:s,Authors:c,TextReference:v,LinkReference:y,DateRelease:a,PublishBy:l,Cappacity:h,MetaName:i,BookTypeId:r,CategoryId:u,ThumbnailUrl:f,LongDescription:e};n.PdfLink===""&&n.MobiLink===""&&n.EpubLink===""?alert("Vui lòng cung cấp ít nhất một đường dẫn tải ebook ở bên dưới!"):$.ajax({url:"/Books/Post",data:{book:JSON.stringify(k),downloadLink:JSON.stringify(n)},type:"post",dataType:"json",success:function(n){n.status?(location.reload(),toastr.success(n.message)):toastr.error(n.message)}})},sendFeedback:function(){var n=$("#txtId").val(),t=$("#email").val(),i=$("#subject").val(),r=$("#message").val(),u={UserId:n,Subject:i,Email:t,Message:r};$.ajax({url:"/feedback/post",data:{feedback:JSON.stringify(u)},type:"post",dataType:"json",success:function(n){n.status&&toastr.success("Cảm ơn bạn đã gởi phản hồi đến chúng tôi!")}})},SaveChange:function(){var n=$("#txtId").val(),t=$("#txtName").val(),i=$("#txtAddress").val(),r=$("#txtPhoneNumber").val(),u={Id:n,DisplayName:t,Address:i,PhoneNumber:r};$.ajax({url:"/UserAccount/UpdateUser",data:{user:JSON.stringify(u)},type:"post",dataType:"json",success:function(n){n.status?($("#editModal").modal("hide"),location.reload(),console.log(n.message)):console.log("lỗi cập nhật!!!")}})},resetPassword:function(n){$.ajax({url:"/UserAccount/SendPasswordResetLink",data:{email:n},type:"post",dataType:"json",success:function(n){status?($("#error-rs").html(n.message),$("#error-rs").delay(500).fadeIn(),$("#error-rs").delay(2e3).fadeOut()):$("#error-rs").html(n.message)}})},register:function(n){var t=JSON.stringify(n);$.ajax({url:"/UserAccount/Register",data:{models:t},type:"post",dataType:"json",success:function(n){var i=$("#validate-register"),t;i.html("");n.status===!0?toastr.success(n.message):(t=n.message,$.each(t,function(n){i.append("<li>"+t[n]+"<\/li>")}),$("#validate-register").delay(500).fadeIn(),$("#validate-register").delay(2e3).fadeOut())}})},login:function(n,t,i){$.ajax({url:"/UserAccount/Login",data:{userName:n,password:t,rememberMe:i},type:"post",dataType:"json",success:function(n){n.status===!0?(toastr.success(n.message),setTimeout(2e3,location.reload())):toastr.error(n.message)}})}};userAccountScripts.Init();